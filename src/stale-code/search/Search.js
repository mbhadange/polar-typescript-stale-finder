"use strict";
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];
    result["default"] = mod;
    return result;
};
Object.defineProperty(exports, "__esModule", { value: true });
const libpath = __importStar(require("path"));
const fs = __importStar(require("fs"));
const FilePaths_1 = require("polar-shared/src/util/FilePaths");
const path = __importStar(require("path"));
class Search {
    static find(dir, opts = new DefaultOpts()) {
        const files = fs.readdirSync(dir);
        const result = [];
        for (const name of files) {
            const path = libpath.join(dir, name);
            const stat = fs.statSync(path);
            const createType = () => {
                if (stat.isDirectory()) {
                    return 'directory';
                }
                if (stat.isFile()) {
                    return 'file';
                }
                return undefined;
            };
            const type = createType();
            if (!type) {
                continue;
            }
            const createRecord = () => {
                return { type, name, path };
            };
            const file = createRecord();
            const acceptFile = () => {
                const acceptExtension = () => {
                    if (!opts.extensions) {
                        return true;
                    }
                    const ext = FilePaths_1.FilePaths.toExtension(path).getOrUndefined();
                    return ext && opts.extensions.includes(ext);
                };
                const acceptType = () => {
                    if (!opts.types) {
                        return true;
                    }
                    return opts.types.includes(type);
                };
                return acceptExtension() && acceptType();
            };
            if (acceptFile()) {
                result.push(file);
            }
            if (opts.recurse && type === 'directory') {
                result.push(...this.find(path, opts));
            }
        }
        return result;
    }
}
exports.Search = Search;
class DefaultOpts {
    constructor() {
        this.recurse = true;
        this.types = ['file'];
    }
}
let hitMap = new Map();
let opts = new DefaultOpts();
var myArgs = process.argv[2];
var fileMap = Search.find(myArgs, opts);
for (var i = 0; i < fileMap.length; i++) {
    var file = fileMap[i];
    var initialFileName = file.name;
    var initialFilePath = file.path;
    if (file.name === 'test.ts' || file.name.includes('.d.ts')) {
        continue;
    }
    else if (initialFileName.split('.').pop() === 'ts' || initialFileName.split('.').pop() === 'tsx') {
        const data = fs.readFileSync(initialFilePath, 'utf8');
        const lines = data.split(/\r?\n/);
        let re = /import(?:["'\s]*([\w*{}\n\r\t, ]+)from\s*)?["'\s].*([@\w_-]+)["'\s].*;$/;
        lines.forEach((line) => {
            let importLine = line.match(re);
            if (importLine != null) {
                let importVal = importLine[0];
                let filePath = importVal.split(' ').pop();
                var fullPath;
                if (filePath != undefined) {
                    if (filePath.includes('./') || filePath.includes('../')) {
                        filePath = filePath.replace(/['"]+/g, '');
                        if (filePath.includes('.ts') == false) {
                            filePath = filePath.replace(filePath.substring(filePath.length - 1), "");
                            filePath = filePath + '.ts';
                        }
                        var fullDirectory = path.dirname(initialFilePath);
                        fullPath = path.resolve(fullDirectory, initialFileName);
                        if (fs.existsSync(fullPath) == false) {
                            console.warn("File does not exist: " + fullPath);
                        }
                    }
                }
                if (hitMap.has(fullPath) === true) {
                    var currVal = hitMap.get(fullPath);
                    hitMap.set(fullPath, currVal + 1);
                }
                else {
                    hitMap.set(fullPath, 1);
                }
            }
        });
    }
}
hitMap[Symbol.iterator] = function* () {
    yield* [...this.entries()].sort((a, b) => a[1] - b[1]);
};
var updatedHitMap = [...hitMap];
var finalHitMap = [];
for (var index = 0; index < updatedHitMap.length; index++) {
    var currentArray = updatedHitMap[index];
    var key = currentArray[0];
    var value = currentArray[1];
    finalHitMap[index] = [value, key];
}
console.log(finalHitMap);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiU2VhcmNoLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiU2VhcmNoLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUNBLDhDQUFnQztBQUNoQyx1Q0FBeUI7QUFDekIsK0RBQTBEO0FBRTFELDJDQUE2QjtBQUU3QixNQUFhLE1BQU07SUFDUixNQUFNLENBQUMsSUFBSSxDQUFDLEdBQVcsRUFBRSxPQUFhLElBQUksV0FBVyxFQUFFO1FBQzFELE1BQU0sS0FBSyxHQUFHLEVBQUUsQ0FBQyxXQUFXLENBQUMsR0FBRyxDQUFDLENBQUM7UUFFbEMsTUFBTSxNQUFNLEdBQVksRUFBRSxDQUFDO1FBRTNCLEtBQUssTUFBTSxJQUFJLElBQUksS0FBSyxFQUFFO1lBRXRCLE1BQU0sSUFBSSxHQUFHLE9BQU8sQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFLElBQUksQ0FBQyxDQUFDO1lBQ3JDLE1BQU0sSUFBSSxHQUFHLEVBQUUsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUM7WUFFL0IsTUFBTSxVQUFVLEdBQUcsR0FBeUIsRUFBRTtnQkFDMUMsSUFBSSxJQUFJLENBQUMsV0FBVyxFQUFFLEVBQUU7b0JBQ3BCLE9BQU8sV0FBVyxDQUFDO2lCQUN0QjtnQkFFRCxJQUFJLElBQUksQ0FBQyxNQUFNLEVBQUUsRUFBRTtvQkFDZixPQUFPLE1BQU0sQ0FBQztpQkFDakI7Z0JBQ0QsT0FBTyxTQUFTLENBQUM7WUFDckIsQ0FBQyxDQUFDO1lBQ0YsTUFBTSxJQUFJLEdBQUcsVUFBVSxFQUFFLENBQUM7WUFDMUIsSUFBSSxDQUFFLElBQUksRUFBRTtnQkFDUixTQUFTO2FBQ1o7WUFDRCxNQUFNLFlBQVksR0FBRyxHQUFVLEVBQUU7Z0JBQzdCLE9BQU8sRUFBQyxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBQyxDQUFDO1lBQzlCLENBQUMsQ0FBQztZQUVGLE1BQU0sSUFBSSxHQUFHLFlBQVksRUFBRSxDQUFDO1lBSzVCLE1BQU0sVUFBVSxHQUFH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USxFQUFFLE9BQU8sR0FBRyxDQUFDLENBQUMsQ0FBQztpQkFDckM7cUJBRUk7b0JBRUQsTUFBTSxDQUFDLEdBQUcsQ0FBQyxRQUFRLEVBQUUsQ0FBQyxDQUFDLENBQUM7aUJBQzNCO2FBQ0o7UUFDTCxDQUFDLENBQUMsQ0FBQztLQUNOO0NBQ0o7QUFLRCxNQUFNLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxHQUFHLFFBQVEsQ0FBQztJQUMvQixLQUFLLENBQUMsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBQzNELENBQUMsQ0FBQTtBQUdELElBQUksYUFBYSxHQUFHLENBQUMsR0FBRyxNQUFNLENBQUMsQ0FBQztBQUtoQyxJQUFJLFdBQVcsR0FBRyxFQUFFLENBQUM7QUFDckIsS0FBSyxJQUFJLEtBQUssR0FBRyxDQUFDLEVBQUUsS0FBSyxHQUFHLGFBQWEsQ0FBQyxNQUFNLEVBQUUsS0FBSyxFQUFFLEVBQUU7SUFDdkQsSUFBSSxZQUFZLEdBQUcsYUFBYSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ3hDLElBQUksR0FBRyxHQUFHLFlBQVksQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUMxQixJQUFJLEtBQUssR0FBRyxZQUFZLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDNUIsV0FBVyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsS0FBSyxFQUFFLEdBQUcsQ0FBQyxDQUFDO0NBQ3JDO0FBRUQsT0FBTyxDQUFDLEdBQUcsQ0FBQyxXQUFXLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBFcnJub0V4Y2VwdGlvbiA9IE5vZGVKUy5FcnJub0V4Y2VwdGlvbjtcbmltcG9ydCAqIGFzIGxpYnBhdGggZnJvbSBcInBhdGhcIjtcbmltcG9ydCAqIGFzIGZzIGZyb20gXCJmc1wiO1xuaW1wb3J0IHtGaWxlUGF0aHN9IGZyb20gXCJwb2xhci1zaGFyZWQvc3JjL3V0aWwvRmlsZVBhdGhzXCI7XG5pbXBvcnQge1BhdGhTdHJ9IGZyb20gXCJwb2xhci1zaGFyZWQvc3JjL3V0aWwvU3RyaW5nc1wiO1xuaW1wb3J0ICogYXMgcGF0aCBmcm9tICdwYXRoJztcblxuZXhwb3J0IGNsYXNzIFNlYXJjaCB7XG4gICAgcHVibGljIHN0YXRpYyBmaW5kKGRpcjogc3RyaW5nLCBvcHRzOiBPcHRzID0gbmV3IERlZmF1bHRPcHRzKCkpOiBSZWFkb25seUFycmF5PElGaWxlPiB7XG4gICAgICAgIGNvbnN0IGZpbGVzID0gZnMucmVhZGRpclN5bmMoZGlyKTtcblxuICAgICAgICBjb25zdCByZXN1bHQ6IElGaWxlW10gPSBbXTtcblxuICAgICAgICBmb3IgKGNvbnN0IG5hbWUgb2YgZmlsZXMpIHtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgY29uc3QgcGF0aCA9IGxpYnBhdGguam9pbihkaXIsIG5hbWUpO1xuICAgICAgICAgICAgY29uc3Qgc3RhdCA9IGZzLnN0YXRTeW5jKHBhdGgpO1xuXG4gICAgICAgICAgICBjb25zdCBjcmVhdGVUeXBlID0gKCk6IEZpbGVUeXBlIHwgdW5kZWZpbmVkID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoc3RhdC5pc0RpcmVjdG9yeSgpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAnZGlyZWN0b3J5JztcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoc3RhdC5pc0ZpbGUoKSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ2ZpbGUnO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGNvbnN0IHR5cGUgPSBjcmVhdGVUeXBlKCk7XG4gICAgICAgICAgICBpZiAoISB0eXBlKSB7XG4gICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCBjcmVhdGVSZWNvcmQgPSAoKTogSUZpbGUgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiB7dHlwZSwgbmFtZSwgcGF0aH07XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBjb25zdCBmaWxlID0gY3JlYXRlUmVjb3JkKCk7XG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogUmV0dXJuIHRydWUgaWYgd2Ugc2hvdWxkIGFjY2VwdCB0aGUgZmlsZS5cbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgY29uc3QgYWNjZXB0RmlsZSA9ICgpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBhY2NlcHRFeHRlbnNpb24gPSAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghIG9wdHMuZXh0ZW5zaW9ucykge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZXh0ID0gRmlsZVBhdGhzLnRvRXh0ZW5zaW9uKHBhdGgpLmdldE9yVW5kZWZpbmVkKCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBleHQgJiYgb3B0cy5leHRlbnNpb25zLmluY2x1ZGVzKGV4dCk7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBjb25zdCBhY2NlcHRUeXBlID0gKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAoISBvcHRzLnR5cGVzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gb3B0cy50eXBlcy5pbmNsdWRlcyh0eXBlKTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIHJldHVybiBhY2NlcHRFeHRlbnNpb24oKSAmJiBhY2NlcHRUeXBlKCk7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgaWYgKGFjY2VwdEZpbGUoKSkge1xuICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKGZpbGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKG9wdHMucmVjdXJzZSAmJiB0eXBlID09PSAnZGlyZWN0b3J5Jykge1xuICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKC4uLnRoaXMuZmluZChwYXRoLCBvcHRzKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9XG59XG5cbi8vLyB0aGUgZmlsZSB0eXBlIHRoYXQgaXMgY29tcGF0aWJhbGVcbmV4cG9ydCB0eXBlIEZpbGVUeXBlID0gJ2ZpbGUnIHwgJ2RpcmVjdG9yeSc7XG4vLy8gQSBmaWxlIGV4dGVuc2lvbiB3aXRob3V0IHRoZSAnLicgcHJlZml4LiAgRXhhbXBsZToganBnLCBqcGVnLCB0eHRcbmV4cG9ydCB0eXBlIEZpbGVFeHQgPSBzdHJpbmc7XG5cbmNsYXNzIERlZmF1bHRPcHRzIGltcGxlbWVudHMgT3B0cyB7XG4gICAgcHVibGljIHJlYWRvbmx5IHJlY3Vyc2UgPSB0cnVlO1xuICAgIHB1YmxpYyByZWFkb25seSB0eXBlczogUmVhZG9ubHlBcnJheTxGaWxlVHlwZT4gPSBbJ2ZpbGUnXTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBPcHRzIHtcbiAgICByZWFkb25seSByZWN1cnNlPzogYm9vbGVhbjtcbiAgICAvLy8gT25seSBhY2NlcHQgdGhlIGdpdmVuIGZpbGUgdHlwZXMuICBCeSBkZWZhdWx0IGFsbCB0eXBlcyBhcmUgYWNjZXB0ZWQuXG4gICAgcmVhZG9ubHkgdHlwZXM/OiBSZWFkb25seUFycmF5PEZpbGVUeXBlPjsgXG4gICAgLy8vIE9ubHkgYWNjZXB0IHRoZSBnaXZlbiBleHRlbnNpb25zLiBCeSBkZWZhdWx0IGFsbCBleHRlbnNpb24gYXJlIGFjY2VwdGVkLlxuICAgIHJlYWRvbmx5IGV4dGVuc2lvbnM/OiBSZWFkb25seUFycmF5PEZpbGVFeHQ+OyBcbn1cblxuZXhwb3J0IGludGVyZmFjZSBJRmlsZSB7XG4gICAgcmVhZG9ubHkgbmFtZTogc3RyaW5nOyBcbiAgICByZWFkb25seSBwYXRoOiBQYXRoU3RyOyAvLy8gdGhlIGVudGlyZSBwYXRoIG9mIHRoZSBmaWxlXG4gICAgcmVhZG9ubHkgdHlwZTogRmlsZVR5cGU7IC8vLyB3aGF0IHR5cGUgdGhlIGZpbGUgaXNcbn1cblxuLy8vIGNyZWF0ZXMgYW4gZW1wdHkgbWFwXG5sZXQgaGl0TWFwID0gbmV3IE1hcCgpO1xubGV0IG9wdHMgPSBuZXcgRGVmYXVsdE9wdHMoKTtcblxuLyoqXG4gKiB1c2VzIHByb2Nlc3MuYXJndiB0byBzZWUgd2hpY2ggZGlyZWN0b3J5IHRvIHBhcnNlIHRocm91Z2ggdXNpbmcgdGhlIGNvbW1hbmQgbGluZVxuICogZXhhbXBsZTogbm9kZSBTZWFyY2guanMgL1VzZXJzL21paGlybWFjcHJvMTMvRG9jdW1lbnRzL0dpdEh1Yi9zdGFsZS1maW5kZXItdGVzdC1kaXJlY3RvcnkvXG4gKi8gXG52YXIgbXlBcmdzID0gcHJvY2Vzcy5hcmd2WzJdO1xuLy8vIFNlYXJjaC5maW5kIHJldHVybnMgYW4gYXJyYXkgd2l0aCBhbGwgdGhlIGZpbGVzIGluIHRoZSBkaXJlY3Rvcnlcbi8vLyBpdGVyYXRlcyB0aHJvdWdoIGVhY2ggZmlsZSBpbiB0aGUgZGlyZWN0b3J5XG52YXIgZmlsZU1hcCA9IFNlYXJjaC5maW5kKG15QXJncywgb3B0cyk7XG5mb3IgKHZhciBpID0gMDsgaSA8IGZpbGVNYXAubGVuZ3RoOyBpKyspIHtcbiAgICAvLy8gbWFwIG9mIHRoZSBmaWxlIHR5cGUsIG5hbWUsIHBhdGggXG4gICAgdmFyIGZpbGUgPSBmaWxlTWFwW2ldO1xuICAgIHZhciBpbml0aWFsRmlsZU5hbWUgPSBmaWxlLm5hbWU7XG4gICAgdmFyIGluaXRpYWxGaWxlUGF0aCA9IGZpbGUucGF0aDtcbiAgICBcbiAgICAvLy8gY2hlY2tzIHRvIHNlZSBpZiB0aGUgZmlsZSBuYW1lIGlzIHRlc3QudHNcbiAgICAvLy8gaWYgaXQgaXMgdGhlbiBjb250aW51ZXMgdG8gdGhlIG5leHQgZmlsZVxuICAgIGlmIChmaWxlLm5hbWUgPT09ICd0ZXN0LnRzJyAgfHwgZmlsZS5uYW1lLmluY2x1ZGVzKCcuZC50cycpKSB7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgIH1cbiAgICAvLy8gY2hlY2tzIHRvIG1ha2Ugc3VyZSB0aGF0IHRoZSBmaWxlIHR5cGUgaXMgZWl0aGVyIC50cyBvciAudHN4XG4gICAgZWxzZSBpZiAoaW5pdGlhbEZpbGVOYW1lLnNwbGl0KCcuJykucG9wKCkgPT09ICd0cycgfHwgaW5pdGlhbEZpbGVOYW1lLnNwbGl0KCcuJykucG9wKCkgPT09ICd0c3gnKSB7XG4gICAgICAgIC8vLyBnZXRzIGFsbCB0aGUgY29udGVudHMgb2YgdGhlIGN1cnJlbnQgZmlsZVxuICAgICAgICBjb25zdCBkYXRhID0gZnMucmVhZEZpbGVTeW5jKGluaXRpYWxGaWxlUGF0aCwndXRmOCcpO1xuICAgICAgICAvLy8gc3BsaXRzIGVhY2ggbGluZSBvZiBkYXRhIHRvIGFsbG93IHVzIHRvIHBhcnNlIHRocm91Z2ggZWFjaCBvbmVcbiAgICAgICAgY29uc3QgbGluZXMgPSBkYXRhLnNwbGl0KC9cXHI/XFxuLyk7XG4gICAgICAgIC8vLyBjcmVhdGVzIGEgcmVndWxhciBleHByZXNzaW9uIGZvciB0aGUgaW1wb3J0IGxpbmVzXG4gICAgICAgIGxldCByZSA9IC9pbXBvcnQoPzpbXCInXFxzXSooW1xcdyp7fVxcblxcclxcdCwgXSspZnJvbVxccyopP1tcIidcXHNdLiooW0BcXHdfLV0rKVtcIidcXHNdLio7JC87XG4gICAgICAgIC8vLyBpdGVyYXRlcyB0aHJvdWdoIGVhY2ggbGluZSBvZiB0aGUgZmlsZVxuICAgICAgICBsaW5lcy5mb3JFYWNoKChsaW5lKSA9PiB7XG4gICAgICAgICAgICAvLy8gY2hlY2tzIHRvIHNlZSBpZiB0aGUgbGluZSBtYXRjaGVzIHRoZSBmb3JtYXQgb2YgdGhlIHJlZ3VsYXIgZXhwcmVzc2lvblxuICAgICAgICAgICAgbGV0IGltcG9ydExpbmUgPSBsaW5lLm1hdGNoKHJlKTtcbiAgICAgICAgICAgIC8vLyBtYWtlcyBzdXJlIHRoYXQgdGhlIGxpbmUgYWN0dWFsbHkgaGFzIHRoZSBwcm9wZXIgZm9ybWF0IG9mIHRoZSByZWdFeFxuICAgICAgICAgICAgaWYgKGltcG9ydExpbmUgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIC8vLyBnZXRzIHRoZSBlbnRpcmUgaW1wb3J0IGxpbmVzIGNvbnRlbnRzXG4gICAgICAgICAgICAgICAgbGV0IGltcG9ydFZhbCA9IGltcG9ydExpbmVbMF07XG4gICAgICAgICAgICAgICAgLy8vIHNwbGl0cyB0aGUgbGluZSBiYXNlZCBvZmYgc3BhY2VzIGFuZCBnZXRzIG9ubHkgdGhlIGZpbGUgcGF0aFxuICAgICAgICAgICAgICAgIGxldCBmaWxlUGF0aCA9IGltcG9ydFZhbC5zcGxpdCgnICcpLnBvcCgpO1xuICAgICAgICAgICAgICAgIHZhciBmdWxsUGF0aDtcbiAgICAgICAgICAgICAgICAvLy8gY29udmVydHMgdGhhdCBmaWxlIHBhdGggaW50byBhIGZ1bGwgZmlsZSBwYXRoXG4gICAgICAgICAgICAgICAgaWYgKGZpbGVQYXRoICE9IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZmlsZVBhdGguaW5jbHVkZXMoJy4vJykgfHwgZmlsZVBhdGguaW5jbHVkZXMoJy4uLycpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLy8gZml4ZXMgdGhlIHB1bmN0dWF0aW9uIG9mIHRoZSBmaWxlIHBhdGggb2YgdGhlIGltcG9ydFxuICAgICAgICAgICAgICAgICAgICAgICAgZmlsZVBhdGggPSBmaWxlUGF0aC5yZXBsYWNlKC9bJ1wiXSsvZywgJycpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZpbGVQYXRoLmluY2x1ZGVzKCcudHMnKSA9PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVQYXRoID0gZmlsZVBhdGgucmVwbGFjZShmaWxlUGF0aC5zdWJzdHJpbmcoZmlsZVBhdGgubGVuZ3RoLTEpLCBcIlwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlUGF0aCA9IGZpbGVQYXRoICsgJy50cyc7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgICAgICAgICAqIGNyZWF0ZXMgdGhlIGZ1bGwgcGF0aCB3aXRoIHRoZSBwcm9wZXIgZGlyZWN0b3J5IG5hbWUgXG4gICAgICAgICAgICAgICAgICAgICAgICAgKiBjaGVja3MgdG8gbWFrZSBzdXJlIHRoYXQgdGhlIHBhdGggZXhpc3RzXG4gICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmdWxsRGlyZWN0b3J5ID0gcGF0aC5kaXJuYW1lKGluaXRpYWxGaWxlUGF0aCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBmdWxsUGF0aCA9IHBhdGgucmVzb2x2ZShmdWxsRGlyZWN0b3J5LCBpbml0aWFsRmlsZU5hbWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZzLmV4aXN0c1N5bmMoZnVsbFBhdGgpID09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS53YXJuKFwiRmlsZSBkb2VzIG5vdCBleGlzdDogXCIgKyBmdWxsUGF0aCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLy8gY2hlY2tzIHRvIHNlZSBpZiB0aGUgaGl0bWFwIGFscmVhZHkgaGFzIHRoYXQgcGF0aFxuICAgICAgICAgICAgICAgIGlmIChoaXRNYXAuaGFzKGZ1bGxQYXRoKSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICAvLy8gaWYgaXQgZG9lcyB0aGVuIGluY3JlbWVudHMgdGhlIHZhbHVlIG9mIHRoYXQgZmlsZSBieSAxXG4gICAgICAgICAgICAgICAgICAgIHZhciBjdXJyVmFsID0gaGl0TWFwLmdldChmdWxsUGF0aCk7XG4gICAgICAgICAgICAgICAgICAgIGhpdE1hcC5zZXQoZnVsbFBhdGgsIGN1cnJWYWwgKyAxKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8vIGlmIHRoZSBoaXRtYXAgZG9lcyBub3QgaGF2ZSB0aGF0IHBhdGggYXMgYSBrZXkgYWxyZWFkeVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAvLy8gdGhlbiBzZXRzIHRoYXQgZmlsZSBwYXRoIHRvIGhhdmUgYSB2YWx1ZSBvZiAxXG4gICAgICAgICAgICAgICAgICAgIGhpdE1hcC5zZXQoZnVsbFBhdGgsIDEpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxufVxuXG4vKipcbiAqIFNvcnRzIHRoZSBtYXAgaW4gb3JkZXIgYmFzZWQgb24gdGhlIHZhbHVlcyBcbiAqL1xuaGl0TWFwW1N5bWJvbC5pdGVyYXRvcl0gPSBmdW5jdGlvbiogKCkge1xuICAgIHlpZWxkKiBbLi4udGhpcy5lbnRyaWVzKCldLnNvcnQoKGEsIGIpID0+IGFbMV0gLSBiWzFdKTtcbn1cblxuLy8vIG1ha2VzIHRoZSBtYXAgaW50byBhIHRhYmxlIHR5cGUgZm9ybWF0IHdpdGggYSBuZXN0ZWQgYXJyYXlcbnZhciB1cGRhdGVkSGl0TWFwID0gWy4uLmhpdE1hcF07XG5cbi8qKlxuICogc3dhcHMgdGhlIGtleSBhbmQgdGhlIHZhbHVlIG9mIHRoZSBtYXAsIHNvIHRoZSBrZXkgaXMgdGhlIG51bWJlciBvZiBoaXRzIGFuZCB0aGUgdmFsdWUgaXMgdGhlIGZ1bGwgZmlsZSBwYXRoXG4gKi9cbnZhciBmaW5hbEhpdE1hcCA9IFtdO1xuZm9yICh2YXIgaW5kZXggPSAwOyBpbmRleCA8IHVwZGF0ZWRIaXRNYXAubGVuZ3RoOyBpbmRleCsrKSB7XG4gICAgdmFyIGN1cnJlbnRBcnJheSA9IHVwZGF0ZWRIaXRNYXBbaW5kZXhdO1xuICAgIHZhciBrZXkgPSBjdXJyZW50QXJyYXlbMF07XG4gICAgdmFyIHZhbHVlID0gY3VycmVudEFycmF5WzFdO1xuICAgIGZpbmFsSGl0TWFwW2luZGV4XSA9IFt2YWx1ZSwga2V5XTtcbn1cbi8vLyBwcmludHMgb3V0IHRoZSBoaXRNYXBcbmNvbnNvbGUubG9nKGZpbmFsSGl0TWFwKTsgXG4iXX0=