"use strict";
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];
    result["default"] = mod;
    return result;
};
Object.defineProperty(exports, "__esModule", { value: true });
const fs = __importStar(require("fs"));
const path = __importStar(require("path"));
const find_1 = require("./find");
const find_2 = require("./find");
let hitMap = new Map();
var argument = process.argv;
for (var x = 2; x < argument.length; x++) {
    let opts = new find_2.DefaultOpts();
    var myArgs = argument[x];
    var fileMap = find_1.Search.find(myArgs, opts);
    for (var k = 0; k < fileMap.length; k++) {
        if (hitMap.has(fileMap[k].path) == false) {
            if (fileMap[k].name.includes('test.ts') || fileMap[k].name.includes('.d.ts')) {
                continue;
            }
            else if (fileMap[k].name.split('.').pop() === 'ts' || fileMap[k].name.split('.').pop() === 'tsx') {
                hitMap.set(fileMap[k].path, 0);
            }
        }
    }
    for (var i = 0; i < fileMap.length; i++) {
        var file = fileMap[i];
        var initialFileName = file.name;
        var initialFilePath = file.path;
        if (file.name.includes('test.ts') || file.name.includes('.d.ts')) {
            continue;
        }
        else if (initialFileName.split('.').pop() === 'ts' || initialFileName.split('.').pop() === 'tsx') {
            const data = fs.readFileSync(initialFilePath, 'utf8');
            const lines = data.split(/\r?\n/);
            let re = /import(?:["'\s]*([\w*{}\n\r\t, ]+)from\s*)?["'\s].*([@\w_-]+)["'\s].*;$/;
            lines.forEach((line) => {
                let importLine = line.match(re);
                if (importLine != null) {
                    let importVal = importLine[0];
                    let filePath = importVal.split(' ').pop();
                    var fullPath;
                    if (filePath != undefined) {
                        if (filePath.includes('./') || filePath.includes('../')) {
                            filePath = filePath.replace(/['"]+/g, '');
                            if (filePath.includes('.ts') == false) {
                                filePath = filePath.replace(filePath.substring(filePath.length - 1), "");
                                filePath = filePath + '.ts';
                            }
                            var fullDirectory = path.dirname(initialFilePath);
                            fullPath = path.resolve(fullDirectory, filePath);
                            if (fs.existsSync(fullPath) == false) {
                                fullPath = fullPath + 'x';
                                if (fs.existsSync(fullPath) == false) {
                                    fullPath = fullPath.replace(fullPath.substring(fullPath.length - 3), "");
                                    fullPath = fullPath + 'd.ts';
                                    if (fullPath.includes('utils.js.d.ts')) {
                                        fullPath = fullPath.replace(fullPath.substring(fullPath.length - 7), "");
                                        fullPath = fullPath + 'ts';
                                    }
                                    if (fs.existsSync(fullPath) == false) {
                                        console.warn("File does not exist: " + fullPath);
                                    }
                                }
                            }
                        }
                    }
                    if (fullPath != undefined) {
                        if (hitMap.has(fullPath) === true) {
                            var currVal = hitMap.get(fullPath);
                            hitMap.set(fullPath, currVal + 1);
                        }
                        else {
                            hitMap.set(fullPath, 1);
                        }
                    }
                }
            });
        }
    }
}
hitMap[Symbol.iterator] = function* () {
    yield* [...this.entries()].sort((a, b) => a[1] - b[1]);
};
var updatedHitMap = [...hitMap];
var finalHitMap = [];
for (var index = 0; index < updatedHitMap.length; index++) {
    var currentArray = updatedHitMap[index];
    var key = currentArray[0];
    var value = currentArray[1];
    finalHitMap[index] = [value, key];
}
for (var j = 0; j < finalHitMap.length; j++) {
    var curr = finalHitMap[j];
    if (curr[1].includes('Test') == false && curr[1].includes('test') == false) {
        console.log(curr[0], ' ', curr[1]);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiU2VhcmNoLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiU2VhcmNoLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUNBLHVDQUF5QjtBQUN6QiwyQ0FBNkI7QUFDN0IsaUNBQThCO0FBQzlCLGlDQUFtQztBQUduQyxJQUFJLE1BQU0sR0FBRyxJQUFJLEdBQUcsRUFBRSxDQUFDO0FBTXZCLElBQUksUUFBUSxHQUFHLE9BQU8sQ0FBQyxJQUFJLENBQUM7QUFDNUIsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLFFBQVEsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUU7SUFDdEMsSUFBSSxJQUFJLEdBQUcsSUFBSSxrQkFBVyxFQUFFLENBQUM7SUFDN0IsSUFBSSxNQUFNLEdBQUcsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBSXpCLElBQUksT0FBTyxHQUFHLGFBQU0sQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLElBQUksQ0FBQyxDQUFDO0lBQ3hDLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxPQUFPLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFFO1FBQ3JDLElBQUksTUFBTSxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksS0FBSyxFQUFFO1lBQ3RDLElBQUksT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsU0FBUyxDQUFDLElBQUssT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLEVBQUU7Z0JBQzNFLFNBQVM7YUFDWjtpQkFFSSxJQUFJLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsRUFBRSxLQUFLLElBQUksSUFBSSxPQUFPLENBQUMsQ0FBQyxDQUFDLENB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QUMsQ0FBQyxDQUFDO0FBQzNELENBQUMsQ0FBQTtBQUdELElBQUksYUFBYSxHQUFHLENBQUMsR0FBRyxNQUFNLENBQUMsQ0FBQztBQUtoQyxJQUFJLFdBQVcsR0FBRyxFQUFFLENBQUM7QUFDckIsS0FBSyxJQUFJLEtBQUssR0FBRyxDQUFDLEVBQUUsS0FBSyxHQUFHLGFBQWEsQ0FBQyxNQUFNLEVBQUUsS0FBSyxFQUFFLEVBQUU7SUFDdkQsSUFBSSxZQUFZLEdBQUcsYUFBYSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ3hDLElBQUksR0FBRyxHQUFHLFlBQVksQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUMxQixJQUFJLEtBQUssR0FBRyxZQUFZLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDNUIsV0FBVyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsS0FBSyxFQUFFLEdBQUcsQ0FBQyxDQUFDO0NBQ3JDO0FBS0QsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLFdBQVcsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUU7SUFDekMsSUFBSSxJQUFJLEdBQUcsV0FBVyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQzFCLElBQUksSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsSUFBSSxLQUFLLElBQUksSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsSUFBSSxLQUFLLEVBQUU7UUFDeEUsT0FBTyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsR0FBRyxFQUFFLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0tBQ3RDO0NBQ0oiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgRXJybm9FeGNlcHRpb24gPSBOb2RlSlMuRXJybm9FeGNlcHRpb247XG5pbXBvcnQgKiBhcyBmcyBmcm9tIFwiZnNcIjtcbmltcG9ydCAqIGFzIHBhdGggZnJvbSAncGF0aCc7XG5pbXBvcnQge1NlYXJjaH0gZnJvbSBcIi4vZmluZFwiO1xuaW1wb3J0IHtEZWZhdWx0T3B0c30gZnJvbSBcIi4vZmluZFwiO1xuXG4vLy8gY3JlYXRlcyBhbiBlbXB0eSBtYXBcbmxldCBoaXRNYXAgPSBuZXcgTWFwKCk7XG5cbi8qKlxuICogdXNlcyBwcm9jZXNzLmFyZ3YgdG8gc2VlIHRha2UgaW4gYW55IG51bWJlciBvZiBkaXJlY3RvcmllcyBpbiB0aGUgY29tbWFuZCBsaW5lXG4gKiBleGFtcGxlOiBub2RlIFNlYXJjaC5qcyAvVXNlcnMvbWloaXJtYWNwcm8xMy9Eb2N1bWVudHMvR2l0SHViL3BvbGFyLWJvb2tzaGVsZi93ZWIvanMgL1VzZXJzL21paGlybWFjcHJvMTMvRG9jdW1lbnRzL0dpdEh1Yi9wb2xhci1ib29rc2hlbGYvYXBwc1xuICovIFxudmFyIGFyZ3VtZW50ID0gcHJvY2Vzcy5hcmd2O1xuZm9yICh2YXIgeCA9IDI7IHggPCBhcmd1bWVudC5sZW5ndGg7IHgrKykge1xuICAgIGxldCBvcHRzID0gbmV3IERlZmF1bHRPcHRzKCk7XG4gICAgdmFyIG15QXJncyA9IGFyZ3VtZW50W3hdO1xuXG4gICAgLy8vIFNlYXJjaC5maW5kIHJldHVybnMgYW4gYXJyYXkgd2l0aCBhbGwgdGhlIGZpbGVzIGluIHRoZSBkaXJlY3RvcnlcbiAgICAvLy8gaXRlcmF0ZXMgdGhyb3VnaCBlYWNoIGZpbGUgaW4gdGhlIGRpcmVjdG9yeVxuICAgIHZhciBmaWxlTWFwID0gU2VhcmNoLmZpbmQobXlBcmdzLCBvcHRzKTtcbiAgICBmb3IgKHZhciBrID0gMDsgayA8IGZpbGVNYXAubGVuZ3RoOyBrKyspIHtcbiAgICAgICAgaWYgKGhpdE1hcC5oYXMoZmlsZU1hcFtrXS5wYXRoKSA9PSBmYWxzZSkge1xuICAgICAgICAgICAgaWYgKGZpbGVNYXBba10ubmFtZS5pbmNsdWRlcygndGVzdC50cycpICB8fCBmaWxlTWFwW2tdLm5hbWUuaW5jbHVkZXMoJy5kLnRzJykpIHtcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vLyBjaGVja3MgdG8gbWFrZSBzdXJlIHRoYXQgdGhlIGZpbGUgdHlwZSBpcyBlaXRoZXIgLnRzIG9yIC50c3hcbiAgICAgICAgICAgIGVsc2UgaWYgKGZpbGVNYXBba10ubmFtZS5zcGxpdCgnLicpLnBvcCgpID09PSAndHMnIHx8IGZpbGVNYXBba10ubmFtZS5zcGxpdCgnLicpLnBvcCgpID09PSAndHN4Jykge1xuICAgICAgICAgICAgICAgIC8vLyBpbml0aWFsaXplcyBoaXRNYXBcbiAgICAgICAgICAgICAgICBoaXRNYXAuc2V0KGZpbGVNYXBba10ucGF0aCwgMCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gXG4gICAgfVxuXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBmaWxlTWFwLmxlbmd0aDsgaSsrKSB7XG5cbiAgICAgICAgLy8vIG1hcCBvZiB0aGUgZmlsZSB0eXBlLCBuYW1lLCBwYXRoIFxuICAgICAgICB2YXIgZmlsZSA9IGZpbGVNYXBbaV07XG4gICAgICAgIHZhciBpbml0aWFsRmlsZU5hbWUgPSBmaWxlLm5hbWU7XG4gICAgICAgIHZhciBpbml0aWFsRmlsZVBhdGggPSBmaWxlLnBhdGg7XG4gICAgICAgIFxuICAgICAgICAvLy8gY2hlY2tzIHRvIHNlZSBpZiB0aGUgZmlsZSBuYW1lIGlzIHRlc3QudHNcbiAgICAgICAgLy8vIGlmIGl0IGlzIHRoZW4gY29udGludWVzIHRvIHRoZSBuZXh0IGZpbGVcbiAgICAgICAgaWYgKGZpbGUubmFtZS5pbmNsdWRlcygndGVzdC50cycpICB8fCBmaWxlLm5hbWUuaW5jbHVkZXMoJy5kLnRzJykpIHtcbiAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG4gICAgICAgIC8vLyBjaGVja3MgdG8gbWFrZSBzdXJlIHRoYXQgdGhlIGZpbGUgdHlwZSBpcyBlaXRoZXIgLnRzIG9yIC50c3hcbiAgICAgICAgZWxzZSBpZiAoaW5pdGlhbEZpbGVOYW1lLnNwbGl0KCcuJykucG9wKCkgPT09ICd0cycgfHwgaW5pdGlhbEZpbGVOYW1lLnNwbGl0KCcuJykucG9wKCkgPT09ICd0c3gnKSB7XG4gICAgICAgICAgICAvLy8gZ2V0cyBhbGwgdGhlIGNvbnRlbnRzIG9mIHRoZSBjdXJyZW50IGZpbGVcbiAgICAgICAgICAgIGNvbnN0IGRhdGEgPSBmcy5yZWFkRmlsZVN5bmMoaW5pdGlhbEZpbGVQYXRoLCd1dGY4Jyk7XG4gICAgICAgICAgICAvLy8gc3BsaXRzIGVhY2ggbGluZSBvZiBkYXRhIHRvIGFsbG93IHVzIHRvIHBhcnNlIHRocm91Z2ggZWFjaCBvbmVcbiAgICAgICAgICAgIGNvbnN0IGxpbmVzID0gZGF0YS5zcGxpdCgvXFxyP1xcbi8pO1xuICAgICAgICAgICAgLy8vIGNyZWF0ZXMgYSByZWd1bGFyIGV4cHJlc3Npb24gZm9yIHRoZSBpbXBvcnQgbGluZXNcbiAgICAgICAgICAgIGxldCByZSA9IC9pbXBvcnQoPzpbXCInXFxzXSooW1xcdyp7fVxcblxcclxcdCwgXSspZnJvbVxccyopP1tcIidcXHNdLiooW0BcXHdfLV0rKVtcIidcXHNdLio7JC87XG4gICAgICAgICAgICAvLy8gaXRlcmF0ZXMgdGhyb3VnaCBlYWNoIGxpbmUgb2YgdGhlIGZpbGVcbiAgICAgICAgICAgIGxpbmVzLmZvckVhY2goKGxpbmUpID0+IHtcbiAgICAgICAgICAgICAgICAvLy8gY2hlY2tzIHRvIHNlZSBpZiB0aGUgbGluZSBtYXRjaGVzIHRoZSBmb3JtYXQgb2YgdGhlIHJlZ3VsYXIgZXhwcmVzc2lvblxuICAgICAgICAgICAgICAgIGxldCBpbXBvcnRMaW5lID0gbGluZS5tYXRjaChyZSk7XG4gICAgICAgICAgICAgICAgLy8vIG1ha2VzIHN1cmUgdGhhdCB0aGUgbGluZSBhY3R1YWxseSBoYXMgdGhlIHByb3BlciBmb3JtYXQgb2YgdGhlIHJlZ0V4XG4gICAgICAgICAgICAgICAgaWYgKGltcG9ydExpbmUgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICAvLy8gZ2V0cyB0aGUgZW50aXJlIGltcG9ydCBsaW5lcyBjb250ZW50c1xuICAgICAgICAgICAgICAgICAgICBsZXQgaW1wb3J0VmFsID0gaW1wb3J0TGluZVswXTtcbiAgICAgICAgICAgICAgICAgICAgLy8vIHNwbGl0cyB0aGUgbGluZSBiYXNlZCBvZmYgc3BhY2VzIGFuZCBnZXRzIG9ubHkgdGhlIGZpbGUgcGF0aFxuICAgICAgICAgICAgICAgICAgICBsZXQgZmlsZVBhdGggPSBpbXBvcnRWYWwuc3BsaXQoJyAnKS5wb3AoKTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGZ1bGxQYXRoO1xuICAgICAgICAgICAgICAgICAgICAvLy8gY29udmVydHMgdGhhdCBmaWxlIHBhdGggaW50byBhIGZ1bGwgZmlsZSBwYXRoXG4gICAgICAgICAgICAgICAgICAgIGlmIChmaWxlUGF0aCAhPSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmaWxlUGF0aC5pbmNsdWRlcygnLi8nKSB8fCBmaWxlUGF0aC5pbmNsdWRlcygnLi4vJykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLy8gZml4ZXMgdGhlIHB1bmN0dWF0aW9uIG9mIHRoZSBmaWxlIHBhdGggb2YgdGhlIGltcG9ydFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVQYXRoID0gZmlsZVBhdGgucmVwbGFjZSgvWydcIl0rL2csICcnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZmlsZVBhdGguaW5jbHVkZXMoJy50cycpID09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVQYXRoID0gZmlsZVBhdGgucmVwbGFjZShmaWxlUGF0aC5zdWJzdHJpbmcoZmlsZVBhdGgubGVuZ3RoLTEpLCBcIlwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZVBhdGggPSBmaWxlUGF0aCArICcudHMnO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBjcmVhdGVzIHRoZSBmdWxsIHBhdGggd2l0aCB0aGUgcHJvcGVyIGRpcmVjdG9yeSBuYW1lIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIGNoZWNrcyB0byBtYWtlIHN1cmUgdGhhdCB0aGUgcGF0aCBleGlzdHNcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZnVsbERpcmVjdG9yeSA9IHBhdGguZGlybmFtZShpbml0aWFsRmlsZVBhdGgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bGxQYXRoID0gcGF0aC5yZXNvbHZlKGZ1bGxEaXJlY3RvcnksIGZpbGVQYXRoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZnMuZXhpc3RzU3luYyhmdWxsUGF0aCkgPT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVsbFBhdGggPSBmdWxsUGF0aCArICd4JztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZzLmV4aXN0c1N5bmMoZnVsbFBhdGgpID09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdWxsUGF0aCA9IGZ1bGxQYXRoLnJlcGxhY2UoZnVsbFBhdGguc3Vic3RyaW5nKGZ1bGxQYXRoLmxlbmd0aC0zKSwgXCJcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdWxsUGF0aCA9IGZ1bGxQYXRoICsgJ2QudHMnO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZ1bGxQYXRoLmluY2x1ZGVzKCd1dGlscy5qcy5kLnRzJykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdWxsUGF0aCA9IGZ1bGxQYXRoLnJlcGxhY2UoZnVsbFBhdGguc3Vic3RyaW5nKGZ1bGxQYXRoLmxlbmd0aC03KSwgXCJcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVsbFBhdGggPSBmdWxsUGF0aCArICd0cyc7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZnMuZXhpc3RzU3luYyhmdWxsUGF0aCkgPT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oXCJGaWxlIGRvZXMgbm90IGV4aXN0OiBcIiArIGZ1bGxQYXRoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZ1bGxQYXRoICE9IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8vIGNoZWNrcyB0byBzZWUgaWYgdGhlIGhpdG1hcCBhbHJlYWR5IGhhcyB0aGF0IHBhdGhcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChoaXRNYXAuaGFzKGZ1bGxQYXRoKSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vLyBpZiBpdCBkb2VzIHRoZW4gaW5jcmVtZW50cyB0aGUgdmFsdWUgb2YgdGhhdCBmaWxlIGJ5IDFcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgY3VyclZhbCA9IGhpdE1hcC5nZXQoZnVsbFBhdGgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhpdE1hcC5zZXQoZnVsbFBhdGgsIGN1cnJWYWwgKyAxKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vLyBpZiB0aGUgaGl0bWFwIGRvZXMgbm90IGhhdmUgdGhhdCBwYXRoIGFzIGEga2V5IGFscmVhZHlcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vLyB0aGVuIHNldHMgdGhhdCBmaWxlIHBhdGggdG8gaGF2ZSBhIHZhbHVlIG9mIDFcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoaXRNYXAuc2V0KGZ1bGxQYXRoLCAxKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxufVxuXG5cblxuLyoqXG4gKiBTb3J0cyB0aGUgbWFwIGluIG9yZGVyIGJhc2VkIG9uIHRoZSB2YWx1ZXMgXG4gKi9cbmhpdE1hcFtTeW1ib2wuaXRlcmF0b3JdID0gZnVuY3Rpb24qICgpIHtcbiAgICB5aWVsZCogWy4uLnRoaXMuZW50cmllcygpXS5zb3J0KChhLCBiKSA9PiBhWzFdIC0gYlsxXSk7XG59XG5cbi8vLyBtYWtlcyB0aGUgbWFwIGludG8gYSB0YWJsZSB0eXBlIGZvcm1hdCB3aXRoIGEgbmVzdGVkIGFycmF5XG52YXIgdXBkYXRlZEhpdE1hcCA9IFsuLi5oaXRNYXBdO1xuXG4vKipcbiAqIHN3YXBzIHRoZSBrZXkgYW5kIHRoZSB2YWx1ZSBvZiB0aGUgbWFwLCBzbyB0aGUgbnVtYmVyIG9mIGhpdHMgaXMgZm9ybWF0dGVkIHRvIHRoZSBsZWZ0IG9mIHRoZSBmdWxsIGZpbGUgcGF0aFxuICovXG52YXIgZmluYWxIaXRNYXAgPSBbXTtcbmZvciAodmFyIGluZGV4ID0gMDsgaW5kZXggPCB1cGRhdGVkSGl0TWFwLmxlbmd0aDsgaW5kZXgrKykge1xuICAgIHZhciBjdXJyZW50QXJyYXkgPSB1cGRhdGVkSGl0TWFwW2luZGV4XTtcbiAgICB2YXIga2V5ID0gY3VycmVudEFycmF5WzBdO1xuICAgIHZhciB2YWx1ZSA9IGN1cnJlbnRBcnJheVsxXTtcbiAgICBmaW5hbEhpdE1hcFtpbmRleF0gPSBbdmFsdWUsIGtleV07XG59XG5cbi8qKlxuICogcHJpbnRzIG91dCB0aGUgZmluYWxIaXRNYXBcbiAqL1xuZm9yICh2YXIgaiA9IDA7IGogPCBmaW5hbEhpdE1hcC5sZW5ndGg7IGorKykge1xuICAgIHZhciBjdXJyID0gZmluYWxIaXRNYXBbal07XG4gICAgaWYgKGN1cnJbMV0uaW5jbHVkZXMoJ1Rlc3QnKSA9PSBmYWxzZSAmJiBjdXJyWzFdLmluY2x1ZGVzKCd0ZXN0JykgPT0gZmFsc2UpIHtcbiAgICAgICAgY29uc29sZS5sb2coY3VyclswXSwgJyAnLCBjdXJyWzFdKTtcbiAgICB9XG59Il19