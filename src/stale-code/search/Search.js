"use strict";
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];
    result["default"] = mod;
    return result;
};
Object.defineProperty(exports, "__esModule", { value: true });
const fs = __importStar(require("fs"));
const path = __importStar(require("path"));
const find_1 = require("./find");
const find_2 = require("./find");
function SetUpMap() {
    for (var k = 0; k < fileMap.length; k++) {
        if (hitMap.has(fileMap[k].path) == false) {
            if (fileMap[k].name.includes('test.ts') || fileMap[k].name.includes('.d.ts')) {
                continue;
            }
            else if (fileMap[k].name.split('.').pop() === 'ts' || fileMap[k].name.split('.').pop() === 'tsx') {
                hitMap.set(fileMap[k].path, 0);
            }
        }
    }
}
function FormatsMap() {
    hitMap[Symbol.iterator] = function* () {
        yield* [...this.entries()].sort((a, b) => a[1] - b[1]);
    };
    var updatedHitMap = [...hitMap];
    var finalHitMap = [];
    for (var index = 0; index < updatedHitMap.length; index++) {
        var currentArray = updatedHitMap[index];
        var key = currentArray[0];
        var value = currentArray[1];
        finalHitMap[index] = [value, key];
    }
    for (var j = 0; j < finalHitMap.length; j++) {
        var curr = finalHitMap[j];
        if (curr[1].includes('Test') == false && curr[1].includes('test') == false) {
            console.log(curr[0], ' ', curr[1]);
        }
    }
}
function UpdateMap() {
    const data = fs.readFileSync(initialFilePath, 'utf8');
    const lines = data.split(/\r?\n/);
    const re = /import(?:["'\s]*([\w*{}\n\r\t, ]+)from\s*)?["'\s].*([@\w_-]+)["'\s].*;$/;
    lines.forEach((line) => {
        var importLine = line.match(re);
        if (importLine != null) {
            var importVal = importLine[0];
            var filePath = importVal.split(' ').pop();
            var fullPath;
            if (filePath != undefined) {
                if (filePath.includes('./') || filePath.includes('../')) {
                    filePath = filePath.replace(/['"]+/g, '');
                    if (filePath.includes('.ts') == false) {
                        filePath = filePath.replace(filePath.substring(filePath.length - 1), "");
                        filePath = filePath + '.ts';
                    }
                    var fullDirectory = path.dirname(initialFilePath);
                    fullPath = path.resolve(fullDirectory, filePath);
                    if (fs.existsSync(fullPath) == false) {
                        fullPath = fullPath + 'x';
                        if (fs.existsSync(fullPath) == false) {
                            fullPath = fullPath.replace(fullPath.substring(fullPath.length - 3), "");
                            fullPath = fullPath + 'd.ts';
                            if (fullPath.includes('utils.js.d.ts')) {
                                fullPath = fullPath.replace(fullPath.substring(fullPath.length - 7), "");
                                fullPath = fullPath + 'ts';
                            }
                            if (fs.existsSync(fullPath) == false) {
                                console.warn("File does not exist: " + fullPath);
                            }
                        }
                    }
                }
            }
            if (fullPath != undefined) {
                if (hitMap.has(fullPath) === true) {
                    var currVal = hitMap.get(fullPath);
                    hitMap.set(fullPath, currVal + 1);
                }
                else {
                    hitMap.set(fullPath, 1);
                }
            }
        }
    });
}
var hitMap = new Map();
var argument = process.argv;
for (var x = 2; x < argument.length; x++) {
    const opts = new find_2.DefaultOpts();
    var myArgs = argument[x];
    var fileMap = find_1.Search.find(myArgs, opts);
    SetUpMap();
    for (var i = 0; i < fileMap.length; i++) {
        var file = fileMap[i];
        var initialFileName = file.name;
        var initialFilePath = file.path;
        if (file.name.includes('test.ts') || file.name.includes('.d.ts')) {
            continue;
        }
        else if (initialFileName.split('.').pop() === 'ts' || initialFileName.split('.').pop() === 'tsx') {
            UpdateMap();
        }
    }
}
FormatsMap();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiU2VhcmNoLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiU2VhcmNoLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUNBLHVDQUF5QjtBQUN6QiwyQ0FBNkI7QUFDN0IsaUNBQThCO0FBQzlCLGlDQUFtQztBQU1uQyxTQUFTLFFBQVE7SUFDYixLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsT0FBTyxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRTtRQUNyQyxJQUFJLE1BQU0sQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLEtBQUssRUFBRTtZQUN0QyxJQUFJLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLFNBQVMsQ0FBQyxJQUFLLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxFQUFFO2dCQUMzRSxTQUFTO2FBQ1o7aUJBRUksSUFBSSxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLEVBQUUsS0FBSyxJQUFJLElBQUksT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxFQUFFLEtBQUssS0FBSyxFQUFFO2dCQUU5RixNQUFNLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUM7YUFDbEM7U0FDSjtLQUNKO0FBQ0wsQ0FBQztBQUtELFNBQVMsVUFBVTtJQUlmLE1BQU0sQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLEdBQUcsUUFBUSxDQUFDO1FBQy9CLEtBQUssQ0FBQyxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMs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dCBFcnJub0V4Y2VwdGlvbiA9IE5vZGVKUy5FcnJub0V4Y2VwdGlvbjtcbmltcG9ydCAqIGFzIGZzIGZyb20gXCJmc1wiO1xuaW1wb3J0ICogYXMgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCB7U2VhcmNofSBmcm9tIFwiLi9maW5kXCI7XG5pbXBvcnQge0RlZmF1bHRPcHRzfSBmcm9tIFwiLi9maW5kXCI7XG5cbi8qKlxuICogU2V0cyB1cCB0aGUgbWFwIGJ5IHNldHRpbmcgYWxsIHRoZSBmaWxlIG5hbWVzIHRvIDAgdGhhdCBoYXZlIGFuIGV4dGVuc3Rpb24gb2YgdHMgb3IgdHN4XG4gKiBDaGVja3MgaWYgZmlsZSBpcyBhbHJlYWR5IGluIHRoZSBtYXBcbiAqL1xuZnVuY3Rpb24gU2V0VXBNYXAoKSB7XG4gICAgZm9yICh2YXIgayA9IDA7IGsgPCBmaWxlTWFwLmxlbmd0aDsgaysrKSB7XG4gICAgICAgIGlmIChoaXRNYXAuaGFzKGZpbGVNYXBba10ucGF0aCkgPT0gZmFsc2UpIHtcbiAgICAgICAgICAgIGlmIChmaWxlTWFwW2tdLm5hbWUuaW5jbHVkZXMoJ3Rlc3QudHMnKSAgfHwgZmlsZU1hcFtrXS5uYW1lLmluY2x1ZGVzKCcuZC50cycpKSB7XG4gICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLy8gY2hlY2tzIHRvIG1ha2Ugc3VyZSB0aGF0IHRoZSBmaWxlIHR5cGUgaXMgZWl0aGVyIC50cyBvciAudHN4XG4gICAgICAgICAgICBlbHNlIGlmIChmaWxlTWFwW2tdLm5hbWUuc3BsaXQoJy4nKS5wb3AoKSA9PT0gJ3RzJyB8fCBmaWxlTWFwW2tdLm5hbWUuc3BsaXQoJy4nKS5wb3AoKSA9PT0gJ3RzeCcpIHtcbiAgICAgICAgICAgICAgICAvLy8gaW5pdGlhbGl6ZXMgaGl0TWFwXG4gICAgICAgICAgICAgICAgaGl0TWFwLnNldChmaWxlTWFwW2tdLnBhdGgsIDApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IFxuICAgIH1cbn1cblxuLyoqXG4gKiBTb3J0cyBhbmQgZm9ybWF0cyB0aGUgbWFwIHNvIGl0IGlzIGluIHByaW50ZWQgcHJvcGVybHkgaW4gYSB0YWJsZVxuICovXG5mdW5jdGlvbiBGb3JtYXRzTWFwKCkge1xuICAgIC8qKlxuICAgICAqIFNvcnRzIHRoZSBtYXAgaW4gb3JkZXIgYmFzZWQgb24gdGhlIHZhbHVlcyBcbiAgICAgKi9cbiAgICBoaXRNYXBbU3ltYm9sLml0ZXJhdG9yXSA9IGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIHlpZWxkKiBbLi4udGhpcy5lbnRyaWVzKCldLnNvcnQoKGEsIGIpID0+IGFbMV0gLSBiWzFdKTtcbiAgICB9XG5cbiAgICAvLy8gbWFrZXMgdGhlIG1hcCBpbnRvIGEgdGFibGUgdHlwZSBmb3JtYXQgd2l0aCBhIG5lc3RlZCBhcnJheVxuICAgIHZhciB1cGRhdGVkSGl0TWFwID0gWy4uLmhpdE1hcF07XG5cbiAgICAvKipcbiAgICAgKiBzd2FwcyB0aGUga2V5IGFuZCB0aGUgdmFsdWUgb2YgdGhlIG1hcCwgc28gdGhlIG51bWJlciBvZiBoaXRzIGlzIGZvcm1hdHRlZCB0byB0aGUgbGVmdCBvZiB0aGUgZnVsbCBmaWxlIHBhdGhcbiAgICAgKi9cbiAgICB2YXIgZmluYWxIaXRNYXAgPSBbXTtcbiAgICBmb3IgKHZhciBpbmRleCA9IDA7IGluZGV4IDwgdXBkYXRlZEhpdE1hcC5sZW5ndGg7IGluZGV4KyspIHtcbiAgICAgICAgdmFyIGN1cnJlbnRBcnJheSA9IHVwZGF0ZWRIaXRNYXBbaW5kZXhdO1xuICAgICAgICB2YXIga2V5ID0gY3VycmVudEFycmF5WzBdO1xuICAgICAgICB2YXIgdmFsdWUgPSBjdXJyZW50QXJyYXlbMV07XG4gICAgICAgIGZpbmFsSGl0TWFwW2luZGV4XSA9IFt2YWx1ZSwga2V5XTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBwcmludHMgb3V0IHRoZSBmaW5hbEhpdE1hcFxuICAgICAqL1xuICAgIGZvciAodmFyIGogPSAwOyBqIDwgZmluYWxIaXRNYXAubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgdmFyIGN1cnIgPSBmaW5hbEhpdE1hcFtqXTtcbiAgICAgICAgaWYgKGN1cnJbMV0uaW5jbHVkZXMoJ1Rlc3QnKSA9PSBmYWxzZSAmJiBjdXJyWzFdLmluY2x1ZGVzKCd0ZXN0JykgPT0gZmFsc2UpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGN1cnJbMF0sICcgJywgY3VyclsxXSk7XG4gICAgICAgIH1cbiAgICB9XG59XG5cbi8qKlxuICogRmluZHMgdGhlIGZ1bGwgcGF0aCBvZiB0aGUgZmlsZSB0aGF0IGlzIGJlaW5nIGltcG9ydGVkIFxuICogVXBkYXRlcyB0aGUgTWFwIHZhbHVlIG9mIHRoYXQgZmlsZVxuICovXG5mdW5jdGlvbiBVcGRhdGVNYXAoKSB7XG4gICAgLy8vIGdldHMgYWxsIHRoZSBjb250ZW50cyBvZiB0aGUgY3VycmVudCBmaWxlXG4gICAgY29uc3QgZGF0YSA9IGZzLnJlYWRGaWxlU3luYyhpbml0aWFsRmlsZVBhdGgsJ3V0ZjgnKTtcbiAgICAvLy8gc3BsaXRzIGVhY2ggbGluZSBvZiBkYXRhIHRvIGFsbG93IHVzIHRvIHBhcnNlIHRocm91Z2ggZWFjaCBvbmVcbiAgICBjb25zdCBsaW5lcyA9IGRhdGEuc3BsaXQoL1xccj9cXG4vKTtcbiAgICAvLy8gY3JlYXRlcyBhIHJlZ3VsYXIgZXhwcmVzc2lvbiBmb3IgdGhlIGltcG9ydCBsaW5lc1xuICAgIGNvbnN0IHJlID0gL2ltcG9ydCg/OltcIidcXHNdKihbXFx3Knt9XFxuXFxyXFx0LCBdKylmcm9tXFxzKik/W1wiJ1xcc10uKihbQFxcd18tXSspW1wiJ1xcc10uKjskLztcbiAgICAvLy8gaXRlcmF0ZXMgdGhyb3VnaCBlYWNoIGxpbmUgb2YgdGhlIGZpbGVcbiAgICBsaW5lcy5mb3JFYWNoKChsaW5lKSA9PiB7XG4gICAgICAgIC8vLyBjaGVja3MgdG8gc2VlIGlmIHRoZSBsaW5lIG1hdGNoZXMgdGhlIGZvcm1hdCBvZiB0aGUgcmVndWxhciBleHByZXNzaW9uXG4gICAgICAgIHZhciBpbXBvcnRMaW5lID0gbGluZS5tYXRjaChyZSk7XG4gICAgICAgIC8vLyBtYWtlcyBzdXJlIHRoYXQgdGhlIGxpbmUgYWN0dWFsbHkgaGFzIHRoZSBwcm9wZXIgZm9ybWF0IG9mIHRoZSByZWdFeFxuICAgICAgICBpZiAoaW1wb3J0TGluZSAhPSBudWxsKSB7XG4gICAgICAgICAgICAvLy8gZ2V0cyB0aGUgZW50aXJlIGltcG9ydCBsaW5lcyBjb250ZW50c1xuICAgICAgICAgICAgdmFyIGltcG9ydFZhbCA9IGltcG9ydExpbmVbMF07XG4gICAgICAgICAgICAvLy8gc3BsaXRzIHRoZSBsaW5lIGJhc2VkIG9mZiBzcGFjZXMgYW5kIGdldHMgb25seSB0aGUgZmlsZSBwYXRoXG4gICAgICAgICAgICB2YXIgZmlsZVBhdGggPSBpbXBvcnRWYWwuc3BsaXQoJyAnKS5wb3AoKTtcbiAgICAgICAgICAgIHZhciBmdWxsUGF0aDtcbiAgICAgICAgICAgIC8vLyBjb252ZXJ0cyB0aGF0IGZpbGUgcGF0aCBpbnRvIGEgZnVsbCBmaWxlIHBhdGhcbiAgICAgICAgICAgIGlmIChmaWxlUGF0aCAhPSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBpZiAoZmlsZVBhdGguaW5jbHVkZXMoJy4vJykgfHwgZmlsZVBhdGguaW5jbHVkZXMoJy4uLycpKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vLyBmaXhlcyB0aGUgcHVuY3R1YXRpb24gb2YgdGhlIGZpbGUgcGF0aCBvZiB0aGUgaW1wb3J0XG4gICAgICAgICAgICAgICAgICAgIGZpbGVQYXRoID0gZmlsZVBhdGgucmVwbGFjZSgvWydcIl0rL2csICcnKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZpbGVQYXRoLmluY2x1ZGVzKCcudHMnKSA9PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZmlsZVBhdGggPSBmaWxlUGF0aC5yZXBsYWNlKGZpbGVQYXRoLnN1YnN0cmluZyhmaWxlUGF0aC5sZW5ndGgtMSksIFwiXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZmlsZVBhdGggPSBmaWxlUGF0aCArICcudHMnO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAgICAgKiBjcmVhdGVzIHRoZSBmdWxsIHBhdGggd2l0aCB0aGUgcHJvcGVyIGRpcmVjdG9yeSBuYW1lIFxuICAgICAgICAgICAgICAgICAgICAgKiBjaGVja3MgdG8gbWFrZSBzdXJlIHRoYXQgdGhlIHBhdGggZXhpc3RzXG4gICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgICAgICB2YXIgZnVsbERpcmVjdG9yeSA9IHBhdGguZGlybmFtZShpbml0aWFsRmlsZVBhdGgpO1xuICAgICAgICAgICAgICAgICAgICBmdWxsUGF0aCA9IHBhdGgucmVzb2x2ZShmdWxsRGlyZWN0b3J5LCBmaWxlUGF0aCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChmcy5leGlzdHNTeW5jKGZ1bGxQYXRoKSA9PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZnVsbFBhdGggPSBmdWxsUGF0aCArICd4JztcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmcy5leGlzdHNTeW5jKGZ1bGxQYXRoKSA9PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bGxQYXRoID0gZnVsbFBhdGgucmVwbGFjZShmdWxsUGF0aC5zdWJzdHJpbmcoZnVsbFBhdGgubGVuZ3RoLTMpLCBcIlwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdWxsUGF0aCA9IGZ1bGxQYXRoICsgJ2QudHMnO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmdWxsUGF0aC5pbmNsdWRlcygndXRpbHMuanMuZC50cycpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bGxQYXRoID0gZnVsbFBhdGgucmVwbGFjZShmdWxsUGF0aC5zdWJzdHJpbmcoZnVsbFBhdGgubGVuZ3RoLTcpLCBcIlwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVsbFBhdGggPSBmdWxsUGF0aCArICd0cyc7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmcy5leGlzdHNTeW5jKGZ1bGxQYXRoKSA9PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oXCJGaWxlIGRvZXMgbm90IGV4aXN0OiBcIiArIGZ1bGxQYXRoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgICAgICBpZiAoZnVsbFBhdGggIT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgLy8vIGNoZWNrcyB0byBzZWUgaWYgdGhlIGhpdG1hcCBhbHJlYWR5IGhhcyB0aGF0IHBhdGhcbiAgICAgICAgICAgICAgICBpZiAoaGl0TWFwLmhhcyhmdWxsUGF0aCkgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8vIGlmIGl0IGRvZXMgdGhlbiBpbmNyZW1lbnRzIHRoZSB2YWx1ZSBvZiB0aGF0IGZpbGUgYnkgMVxuICAgICAgICAgICAgICAgICAgICB2YXIgY3VyclZhbCA9IGhpdE1hcC5nZXQoZnVsbFBhdGgpO1xuICAgICAgICAgICAgICAgICAgICBoaXRNYXAuc2V0KGZ1bGxQYXRoLCBjdXJyVmFsICsgMSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vLyBpZiB0aGUgaGl0bWFwIGRvZXMgbm90IGhhdmUgdGhhdCBwYXRoIGFzIGEga2V5IGFscmVhZHlcbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgLy8vIHRoZW4gc2V0cyB0aGF0IGZpbGUgcGF0aCB0byBoYXZlIGEgdmFsdWUgb2YgMVxuICAgICAgICAgICAgICAgICAgICBoaXRNYXAuc2V0KGZ1bGxQYXRoLCAxKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9KTtcbn1cblxuLy8vIGNyZWF0ZXMgYW4gZW1wdHkgbWFwXG52YXIgaGl0TWFwID0gbmV3IE1hcCgpO1xuXG4vKipcbiAqIHVzZXMgcHJvY2Vzcy5hcmd2IHRvIHNlZSB0YWtlIGluIGFueSBudW1iZXIgb2YgZGlyZWN0b3JpZXMgaW4gdGhlIGNvbW1hbmQgbGluZVxuICogZXhhbXBsZTogbm9kZSBTZWFyY2guanMgL1VzZXJzL21paGlybWFjcHJvMTMvRG9jdW1lbnRzL0dpdEh1Yi9wb2xhci1ib29rc2hlbGYvd2ViL2pzIC9Vc2Vycy9taWhpcm1hY3BybzEzL0RvY3VtZW50cy9HaXRIdWIvcG9sYXItYm9va3NoZWxmL2FwcHNcbiAqLyBcbnZhciBhcmd1bWVudCA9IHByb2Nlc3MuYXJndjtcbmZvciAodmFyIHggPSAyOyB4IDwgYXJndW1lbnQubGVuZ3RoOyB4KyspIHtcbiAgICBjb25zdCBvcHRzID0gbmV3IERlZmF1bHRPcHRzKCk7XG4gICAgdmFyIG15QXJncyA9IGFyZ3VtZW50W3hdO1xuXG4gICAgLy8vIFNlYXJjaC5maW5kIHJldHVybnMgYW4gYXJyYXkgd2l0aCBhbGwgdGhlIGZpbGVzIGluIHRoZSBkaXJlY3RvcnlcbiAgICAvLy8gaXRlcmF0ZXMgdGhyb3VnaCBlYWNoIGZpbGUgaW4gdGhlIGRpcmVjdG9yeVxuICAgIHZhciBmaWxlTWFwID0gU2VhcmNoLmZpbmQobXlBcmdzLCBvcHRzKTtcbiAgICBTZXRVcE1hcCgpO1xuXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBmaWxlTWFwLmxlbmd0aDsgaSsrKSB7XG5cbiAgICAgICAgLy8vIG1hcCBvZiB0aGUgZmlsZSB0eXBlLCBuYW1lLCBwYXRoIFxuICAgICAgICB2YXIgZmlsZSA9IGZpbGVNYXBbaV07XG4gICAgICAgIHZhciBpbml0aWFsRmlsZU5hbWUgPSBmaWxlLm5hbWU7XG4gICAgICAgIHZhciBpbml0aWFsRmlsZVBhdGggPSBmaWxlLnBhdGg7XG4gICAgICAgIFxuICAgICAgICAvLy8gY2hlY2tzIHRvIHNlZSBpZiB0aGUgZmlsZSBuYW1lIGlzIHRlc3QudHNcbiAgICAgICAgLy8vIGlmIGl0IGlzIHRoZW4gY29udGludWVzIHRvIHRoZSBuZXh0IGZpbGVcbiAgICAgICAgaWYgKGZpbGUubmFtZS5pbmNsdWRlcygndGVzdC50cycpICB8fCBmaWxlLm5hbWUuaW5jbHVkZXMoJy5kLnRzJykpIHtcbiAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG4gICAgICAgIC8vLyBjaGVja3MgdG8gbWFrZSBzdXJlIHRoYXQgdGhlIGZpbGUgdHlwZSBpcyBlaXRoZXIgLnRzIG9yIC50c3hcbiAgICAgICAgZWxzZSBpZiAoaW5pdGlhbEZpbGVOYW1lLnNwbGl0KCcuJykucG9wKCkgPT09ICd0cycgfHwgaW5pdGlhbEZpbGVOYW1lLnNwbGl0KCcuJykucG9wKCkgPT09ICd0c3gnKSB7XG4gICAgICAgICAgICBVcGRhdGVNYXAoKTtcbiAgICAgICAgfVxuICAgIH1cbn1cbkZvcm1hdHNNYXAoKTsiXX0=