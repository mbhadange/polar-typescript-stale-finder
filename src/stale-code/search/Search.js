"use strict";
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];
    result["default"] = mod;
    return result;
};
Object.defineProperty(exports, "__esModule", { value: true });
const libpath = __importStar(require("path"));
const fs = __importStar(require("fs"));
const FilePaths_1 = require("polar-shared/src/util/FilePaths");
const readline = __importStar(require("readline"));
class Search {
    static find(dir, opts = new DefaultOpts()) {
        const files = fs.readdirSync(dir);
        const result = [];
        for (const name of files) {
            const path = libpath.join(dir, name);
            const stat = fs.statSync(path);
            const createType = () => {
                if (stat.isDirectory()) {
                    return 'directory';
                }
                if (stat.isFile()) {
                    return 'file';
                }
                return undefined;
            };
            const type = createType();
            if (!type) {
                continue;
            }
            const createRecord = () => {
                return { type, name, path };
            };
            const file = createRecord();
            const acceptFile = () => {
                const acceptExtension = () => {
                    if (!opts.extensions) {
                        return true;
                    }
                    const ext = FilePaths_1.FilePaths.toExtension(path).getOrUndefined();
                    return ext && opts.extensions.includes(ext);
                };
                const acceptType = () => {
                    if (!opts.types) {
                        return true;
                    }
                    return opts.types.includes(type);
                };
                return acceptExtension() && acceptType();
            };
            if (acceptFile()) {
                result.push(file);
            }
            if (opts.recurse && type === 'directory') {
                result.push(...this.find(path, opts));
            }
        }
        return result;
    }
}
exports.Search = Search;
class DefaultOpts {
    constructor() {
        this.recurse = true;
        this.types = ['file'];
    }
}
let hitMap = new Map();
let opts = new DefaultOpts();
let rl = readline.createInterface({
    input: process.stdin,
    output: process.stdout
});
rl.question('Enter the directory to be parsed through: ', (currDirectory) => {
    var fileMap = Search.find(currDirectory, opts);
    for (var i = 0; i < fileMap.length; i++) {
        var file = fileMap[i];
        var initialFileName = file.name;
        var initialFilePath = file.path;
        if (file.name === 'test.ts') {
            continue;
        }
        else if (initialFileName.split('.').pop() === 'ts' || initialFileName.split('.').pop() === 'tsx') {
            const data = fs.readFileSync(initialFilePath, 'utf8');
            const lines = data.split(/\r?\n/);
            let re = /import(?:["'\s]*([\w*{}\n\r\t, ]+)from\s*)?["'\s].*([@\w_-]+)["'\s].*;$/;
            lines.forEach((line) => {
                let importLine = line.match(re);
                if (importLine != null) {
                    let importVal = importLine[0];
                    let filePath = importVal.split(' ').pop();
                    var fullPath = __dirname + filePath;
                    if (hitMap.has(fullPath) === true) {
                        var currVal = hitMap.get(fullPath);
                        hitMap.set(fullPath, currVal + 1);
                    }
                    else {
                        hitMap.set(fullPath, 1);
                    }
                }
            });
        }
    }
    console.log(hitMap);
    rl.close();
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiU2VhcmNoLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiU2VhcmNoLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUNBLDhDQUFnQztBQUNoQyx1Q0FBeUI7QUFDekIsK0RBQTBEO0FBRTFELG1EQUFxQztBQUVyQyxNQUFhLE1BQU07SUFDUixNQUFNLENBQUMsSUFBSSxDQUFDLEdBQVcsRUFBRSxPQUFhLElBQUksV0FBVyxFQUFFO1FBQzFELE1BQU0sS0FBSyxHQUFHLEVBQUUsQ0FBQyxXQUFXLENBQUMsR0FBRyxDQUFDLENBQUM7UUFFbEMsTUFBTSxNQUFNLEdBQVksRUFBRSxDQUFDO1FBRTNCLEtBQUssTUFBTSxJQUFJLElBQUksS0FBSyxFQUFFO1lBRXRCLE1BQU0sSUFBSSxHQUFHLE9BQU8sQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFLElBQUksQ0FBQyxDQUFDO1lBQ3JDLE1BQU0sSUFBSSxHQUFHLEVBQUUsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUM7WUFFL0IsTUFBTSxVQUFVLEdBQUcsR0FBeUIsRUFBRTtnQkFDMUMsSUFBSSxJQUFJLENBQUMsV0FBVyxFQUFFLEVBQUU7b0JBQ3BCLE9BQU8sV0FBVyxDQUFDO2lCQUN0QjtnQkFFRCxJQUFJLElBQUksQ0FBQyxNQUFNLEVBQUUsRUFBRTtvQkFDZixPQUFPLE1BQU0sQ0FBQztpQkFDakI7Z0JBQ0QsT0FBTyxTQUFTLENBQUM7WUFDckIsQ0FBQyxDQUFDO1lBQ0YsTUFBTSxJQUFJLEdBQUcsVUFBVSxFQUFFLENBQUM7WUFDMUIsSUFBSSxDQUFFLElBQUksRUFBRTtnQkFDUixTQUFTO2FBQ1o7WUFDRCxNQUFNLFlBQVksR0FBRyxHQUFVLEVBQUU7Z0JBQzdCLE9BQU8sRUFBQyxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBQyxDQUFDO1lBQzlCLENBQUMsQ0FBQztZQUVGLE1BQU0sSUFBSSxHQUFHLFlBQVksRUFBRSxDQUFDO1lBSzVCLE1BQU0sVUFBVSxHQUFH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Q0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDLENBQUM7Z0JBRWhDLElBQUksVUFBVSxJQUFJLElBQUksRUFBRTtvQkFFcEIsSUFBSSxTQUFTLEdBQUcsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDO29CQUU5QixJQUFJLFFBQVEsR0FBRyxTQUFTLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFDO29CQUUxQyxJQUFJLFFBQVEsR0FBRyxTQUFTLEdBQUcsUUFBUSxDQUFDO29CQUVwQyxJQUFJLE1BQU0sQ0FBQyxHQUFHLENBQUMsUUFBUSxDQUFDLEtBQUssSUFBSSxFQUFFO3dCQUUvQixJQUFJLE9BQU8sR0FBRyxNQUFNLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxDQUFDO3dCQUNuQyxNQUFNLENBQUMsR0FBRyxDQUFDLFFBQVEsRUFBRSxPQUFPLEdBQUcsQ0FBQyxDQUFDLENBQUM7cUJBQ3JDO3lCQUVJO3dCQUVELE1BQU0sQ0FBQyxHQUFHLENBQUMsUUFBUSxFQUFFLENBQUMsQ0FBQyxDQUFDO3FCQUMzQjtpQkFDSjtZQUNMLENBQUMsQ0FBQyxDQUFDO1NBQ047S0FDSjtJQUNELE9BQU8sQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDcEIsRUFBRSxDQUFDLEtBQUssRUFBRSxDQUFDO0FBQ2YsQ0FBQyxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgRXJybm9FeGNlcHRpb24gPSBOb2RlSlMuRXJybm9FeGNlcHRpb247XG5pbXBvcnQgKiBhcyBsaWJwYXRoIGZyb20gXCJwYXRoXCI7XG5pbXBvcnQgKiBhcyBmcyBmcm9tIFwiZnNcIjtcbmltcG9ydCB7RmlsZVBhdGhzfSBmcm9tIFwicG9sYXItc2hhcmVkL3NyYy91dGlsL0ZpbGVQYXRoc1wiO1xuaW1wb3J0IHtQYXRoU3RyfSBmcm9tIFwicG9sYXItc2hhcmVkL3NyYy91dGlsL1N0cmluZ3NcIjtcbmltcG9ydCAqIGFzIHJlYWRsaW5lIGZyb20gJ3JlYWRsaW5lJztcblxuZXhwb3J0IGNsYXNzIFNlYXJjaCB7XG4gICAgcHVibGljIHN0YXRpYyBmaW5kKGRpcjogc3RyaW5nLCBvcHRzOiBPcHRzID0gbmV3IERlZmF1bHRPcHRzKCkpOiBSZWFkb25seUFycmF5PElGaWxlPiB7XG4gICAgICAgIGNvbnN0IGZpbGVzID0gZnMucmVhZGRpclN5bmMoZGlyKTtcblxuICAgICAgICBjb25zdCByZXN1bHQ6IElGaWxlW10gPSBbXTtcblxuICAgICAgICBmb3IgKGNvbnN0IG5hbWUgb2YgZmlsZXMpIHtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgY29uc3QgcGF0aCA9IGxpYnBhdGguam9pbihkaXIsIG5hbWUpO1xuICAgICAgICAgICAgY29uc3Qgc3RhdCA9IGZzLnN0YXRTeW5jKHBhdGgpO1xuXG4gICAgICAgICAgICBjb25zdCBjcmVhdGVUeXBlID0gKCk6IEZpbGVUeXBlIHwgdW5kZWZpbmVkID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoc3RhdC5pc0RpcmVjdG9yeSgpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAnZGlyZWN0b3J5JztcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoc3RhdC5pc0ZpbGUoKSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ2ZpbGUnO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGNvbnN0IHR5cGUgPSBjcmVhdGVUeXBlKCk7XG4gICAgICAgICAgICBpZiAoISB0eXBlKSB7XG4gICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCBjcmVhdGVSZWNvcmQgPSAoKTogSUZpbGUgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiB7dHlwZSwgbmFtZSwgcGF0aH07XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBjb25zdCBmaWxlID0gY3JlYXRlUmVjb3JkKCk7XG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogUmV0dXJuIHRydWUgaWYgd2Ugc2hvdWxkIGFjY2VwdCB0aGUgZmlsZS5cbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgY29uc3QgYWNjZXB0RmlsZSA9ICgpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBhY2NlcHRFeHRlbnNpb24gPSAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghIG9wdHMuZXh0ZW5zaW9ucykge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZXh0ID0gRmlsZVBhdGhzLnRvRXh0ZW5zaW9uKHBhdGgpLmdldE9yVW5kZWZpbmVkKCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBleHQgJiYgb3B0cy5leHRlbnNpb25zLmluY2x1ZGVzKGV4dCk7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBjb25zdCBhY2NlcHRUeXBlID0gKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAoISBvcHRzLnR5cGVzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gb3B0cy50eXBlcy5pbmNsdWRlcyh0eXBlKTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIHJldHVybiBhY2NlcHRFeHRlbnNpb24oKSAmJiBhY2NlcHRUeXBlKCk7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgaWYgKGFjY2VwdEZpbGUoKSkge1xuICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKGZpbGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKG9wdHMucmVjdXJzZSAmJiB0eXBlID09PSAnZGlyZWN0b3J5Jykge1xuICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKC4uLnRoaXMuZmluZChwYXRoLCBvcHRzKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9XG59XG5cbi8vLyB0aGUgZmlsZSB0eXBlIHRoYXQgaXMgY29tcGF0aWJhbGVcbmV4cG9ydCB0eXBlIEZpbGVUeXBlID0gJ2ZpbGUnIHwgJ2RpcmVjdG9yeSc7XG4vLy8gQSBmaWxlIGV4dGVuc2lvbiB3aXRob3V0IHRoZSAnLicgcHJlZml4LiAgRXhhbXBsZToganBnLCBqcGVnLCB0eHRcbmV4cG9ydCB0eXBlIEZpbGVFeHQgPSBzdHJpbmc7XG5cbmNsYXNzIERlZmF1bHRPcHRzIGltcGxlbWVudHMgT3B0cyB7XG4gICAgcHVibGljIHJlYWRvbmx5IHJlY3Vyc2UgPSB0cnVlO1xuICAgIHB1YmxpYyByZWFkb25seSB0eXBlczogUmVhZG9ubHlBcnJheTxGaWxlVHlwZT4gPSBbJ2ZpbGUnXTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBPcHRzIHtcbiAgICByZWFkb25seSByZWN1cnNlPzogYm9vbGVhbjtcbiAgICAvLy8gT25seSBhY2NlcHQgdGhlIGdpdmVuIGZpbGUgdHlwZXMuICBCeSBkZWZhdWx0IGFsbCB0eXBlcyBhcmUgYWNjZXB0ZWQuXG4gICAgcmVhZG9ubHkgdHlwZXM/OiBSZWFkb25seUFycmF5PEZpbGVUeXBlPjsgXG4gICAgLy8vIE9ubHkgYWNjZXB0IHRoZSBnaXZlbiBleHRlbnNpb25zLiBCeSBkZWZhdWx0IGFsbCBleHRlbnNpb24gYXJlIGFjY2VwdGVkLlxuICAgIHJlYWRvbmx5IGV4dGVuc2lvbnM/OiBSZWFkb25seUFycmF5PEZpbGVFeHQ+OyBcbn1cblxuZXhwb3J0IGludGVyZmFjZSBJRmlsZSB7XG4gICAgcmVhZG9ubHkgbmFtZTogc3RyaW5nOyBcbiAgICByZWFkb25seSBwYXRoOiBQYXRoU3RyOyAvLy8gdGhlIGVudGlyZSBwYXRoIG9mIHRoZSBmaWxlXG4gICAgcmVhZG9ubHkgdHlwZTogRmlsZVR5cGU7IC8vLyB3aGF0IHR5cGUgdGhlIGZpbGUgaXNcbn1cblxuLy8vIGNyZWF0ZXMgYW4gZW1wdHkgbWFwXG5sZXQgaGl0TWFwID0gbmV3IE1hcCgpO1xubGV0IG9wdHMgPSBuZXcgRGVmYXVsdE9wdHMoKTtcbi8vLyBhbGxvd3MgdXMgdG8gdGFrZSB1c2VyIGlucHV0XG5sZXQgcmwgPSByZWFkbGluZS5jcmVhdGVJbnRlcmZhY2Uoe1xuICAgIGlucHV0OiBwcm9jZXNzLnN0ZGluLFxuICAgIG91dHB1dDogcHJvY2Vzcy5zdGRvdXRcbn0pO1xuXG4vLyBhc2tzIHVzZXIgdG8gc2VlIHdoaWNoIGRpcmVjdG9yeSB0byBwYXJzZSB0aHJvdWdoXG5ybC5xdWVzdGlvbignRW50ZXIgdGhlIGRpcmVjdG9yeSB0byBiZSBwYXJzZWQgdGhyb3VnaDogJywgKGN1cnJEaXJlY3RvcnkpID0+IHtcbiAgICAvLy8gY29udmVydHMgZW50aXJlIGRpcmVjdG9yeSBuYW1lIHRvIGxvd2VyY2FzZVxuICAgIC8vY3VyckRpcmVjdG9yeS50b0xvd2VyQ2FzZSgpO1xuICAgIC8vLyBTZWFyY2guZmluZCByZXR1cm5zIGFuIGFycmF5IHdpdGggYWxsIHRoZSBmaWxlcyBpbiB0aGUgZGlyZWN0b3J5XG4gICAgLy8vIGl0ZXJhdGVzIHRocm91Z2ggZWFjaCBmaWxlIGluIHRoZSBkaXJlY3RvcnlcbiAgICB2YXIgZmlsZU1hcCA9IFNlYXJjaC5maW5kKGN1cnJEaXJlY3RvcnksIG9wdHMpO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZmlsZU1hcC5sZW5ndGg7IGkrKykge1xuICAgICAgICAvLy8gbWFwIG9mIHRoZSBmaWxlIHR5cGUsIG5hbWUsIHBhdGggXG4gICAgICAgIHZhciBmaWxlID0gZmlsZU1hcFtpXTtcbiAgICAgICAgdmFyIGluaXRpYWxGaWxlTmFtZSA9IGZpbGUubmFtZTtcbiAgICAgICAgdmFyIGluaXRpYWxGaWxlUGF0aCA9IGZpbGUucGF0aDtcblxuICAgICAgICAvLy8gY2hlY2tzIHRvIHNlZSBpZiB0aGUgZmlsZSBuYW1lIGlzIHRlc3QudHNcbiAgICAgICAgLy8vIGlmIGl0IGlzIHRoZW4gY29udGludWVzIHRvIHRoZSBuZXh0IGZpbGVcbiAgICAgICAgaWYgKGZpbGUubmFtZSA9PT0gJ3Rlc3QudHMnKSB7XG4gICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgfVxuICAgICAgICAvLy8gY2hlY2tzIHRvIG1ha2Ugc3VyZSB0aGF0IHRoZSBmaWxlIHR5cGUgaXMgZWl0aGVyIC50cyBvciAudHN4XG4gICAgICAgIGVsc2UgaWYgKGluaXRpYWxGaWxlTmFtZS5zcGxpdCgnLicpLnBvcCgpID09PSAndHMnIHx8IGluaXRpYWxGaWxlTmFtZS5zcGxpdCgnLicpLnBvcCgpID09PSAndHN4Jykge1xuICAgICAgICAgICAgLy8vIGdldHMgYWxsIHRoZSBjb250ZW50cyBvZiB0aGUgY3VycmVudCBmaWxlXG4gICAgICAgICAgICBjb25zdCBkYXRhID0gZnMucmVhZEZpbGVTeW5jKGluaXRpYWxGaWxlUGF0aCwndXRmOCcpO1xuICAgICAgICAgICAgLy8vIHNwbGl0cyBlYWNoIGxpbmUgb2YgZGF0YSB0byBhbGxvdyB1cyB0byBwYXJzZSB0aHJvdWdoIGVhY2ggb25lXG4gICAgICAgICAgICBjb25zdCBsaW5lcyA9IGRhdGEuc3BsaXQoL1xccj9cXG4vKTtcbiAgICAgICAgICAgIC8vLyBjcmVhdGVzIGEgcmVndWxhciBleHByZXNzaW9uIGZvciB0aGUgaW1wb3J0IGxpbmVzXG4gICAgICAgICAgICBsZXQgcmUgPSAvaW1wb3J0KD86W1wiJ1xcc10qKFtcXHcqe31cXG5cXHJcXHQsIF0rKWZyb21cXHMqKT9bXCInXFxzXS4qKFtAXFx3Xy1dKylbXCInXFxzXS4qOyQvO1xuICAgICAgICAgICAgLy8vIGl0ZXJhdGVzIHRocm91Z2ggZWFjaCBsaW5lIG9mIHRoZSBmaWxlXG4gICAgICAgICAgICBsaW5lcy5mb3JFYWNoKChsaW5lKSA9PiB7XG4gICAgICAgICAgICAgICAgLy8vIGNoZWNrcyB0byBzZWUgaWYgdGhlIGxpbmUgbWF0Y2hlcyB0aGUgZm9ybWF0IG9mIHRoZSByZWd1bGFyIGV4cHJlc3Npb25cbiAgICAgICAgICAgICAgICBsZXQgaW1wb3J0TGluZSA9IGxpbmUubWF0Y2gocmUpO1xuICAgICAgICAgICAgICAgIC8vLyBtYWtlcyBzdXJlIHRoYXQgdGhlIGxpbmUgYWN0dWFsbHkgaGFzIHRoZSBwcm9wZXIgZm9ybWF0IG9mIHRoZSByZWdFeFxuICAgICAgICAgICAgICAgIGlmIChpbXBvcnRMaW5lICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8vIGdldHMgdGhlIGVudGlyZSBpbXBvcnQgbGluZXMgY29udGVudHNcbiAgICAgICAgICAgICAgICAgICAgbGV0IGltcG9ydFZhbCA9IGltcG9ydExpbmVbMF07XG4gICAgICAgICAgICAgICAgICAgIC8vLyBzcGxpdHMgdGhlIGxpbmUgYmFzZWQgb2ZmIHNwYWNlcyBhbmQgZ2V0cyBvbmx5IHRoZSBmaWxlIHBhdGhcbiAgICAgICAgICAgICAgICAgICAgbGV0IGZpbGVQYXRoID0gaW1wb3J0VmFsLnNwbGl0KCcgJykucG9wKCk7XG4gICAgICAgICAgICAgICAgICAgIC8vLyBjb252ZXJ0cyB0aGF0IGZpbGUgcGF0aCBpbnRvIGEgZnVsbCBmaWxlIHBhdGhcbiAgICAgICAgICAgICAgICAgICAgdmFyIGZ1bGxQYXRoID0gX19kaXJuYW1lICsgZmlsZVBhdGg7XG4gICAgICAgICAgICAgICAgICAgIC8vLyBjaGVja3MgdG8gc2VlIGlmIHRoZSBoaXRtYXAgYWxyZWFkeSBoYXMgdGhhdCBwYXRoXG4gICAgICAgICAgICAgICAgICAgIGlmIChoaXRNYXAuaGFzKGZ1bGxQYXRoKSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8vIGlmIGl0IGRvZXMgdGhlbiBpbmNyZW1lbnRzIHRoZSB2YWx1ZSBvZiB0aGF0IGZpbGUgYnkgMVxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGN1cnJWYWwgPSBoaXRNYXAuZ2V0KGZ1bGxQYXRoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGhpdE1hcC5zZXQoZnVsbFBhdGgsIGN1cnJWYWwgKyAxKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAvLy8gaWYgdGhlIGhpdG1hcCBkb2VzIG5vdCBoYXZlIHRoYXQgcGF0aCBhcyBhIGtleSBhbHJlYWR5XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8vIHRoZW4gc2V0cyB0aGF0IGZpbGUgcGF0aCB0byBoYXZlIGEgdmFsdWUgb2YgMVxuICAgICAgICAgICAgICAgICAgICAgICAgaGl0TWFwLnNldChmdWxsUGF0aCwgMSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBjb25zb2xlLmxvZyhoaXRNYXApO1xuICAgIHJsLmNsb3NlKCk7XG59KTtcbi8vLyBwcmludHMgb3V0IHRoZSBoaXRtYXBcbiJdfQ==