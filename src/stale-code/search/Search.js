"use strict";
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];
    result["default"] = mod;
    return result;
};
Object.defineProperty(exports, "__esModule", { value: true });
const fs = __importStar(require("fs"));
const path = __importStar(require("path"));
const find_1 = require("./find");
const find_2 = require("./find");
function initializeTypescriptMapFiles(data, currMap) {
    for (var k = 0; k < data.length; k++) {
        if (currMap.has(data[k].path) == false) {
            if (data[k].name.includes('test.ts') || data[k].name.includes('.d.ts')) {
                continue;
            }
            else if (data[k].name.split('.').pop() === 'ts' || data[k].name.split('.').pop() === 'tsx') {
                currMap.set(data[k].path, 0);
            }
        }
    }
}
exports.initializeTypescriptMapFiles = initializeTypescriptMapFiles;
function updateHitMap(currFullPath, currMap) {
    if (currFullPath != undefined) {
        if (currMap.has(currFullPath) === true) {
            var currVal = currMap.get(currFullPath);
            if (currVal != undefined) {
                currMap.set(currFullPath, currVal + 1);
            }
        }
        else {
            currMap.set(currFullPath, 1);
        }
    }
}
exports.updateHitMap = updateHitMap;
function checkFullPath(finalPath) {
    if (fs.existsSync(finalPath) == false) {
        finalPath = finalPath + 'x';
        if (fs.existsSync(finalPath) == false) {
            finalPath = finalPath.replace(finalPath.substring(finalPath.length - 3), "");
            finalPath = finalPath + 'd.ts';
            if (finalPath.includes('utils.js.d.ts')) {
                finalPath = finalPath.replace(finalPath.substring(finalPath.length - 7), "");
                finalPath = finalPath + 'ts';
            }
            if (fs.existsSync(finalPath) == false) {
                console.warn("File does not exist: " + finalPath);
            }
        }
    }
    return finalPath;
}
exports.checkFullPath = checkFullPath;
function expandPath(currPath) {
    currPath = currPath.replace(/['"]+/g, '');
    if (currPath.includes('.ts') == false) {
        currPath = currPath.replace(currPath.substring(currPath.length - 1), "");
        currPath = currPath + '.ts';
    }
    return currPath;
}
exports.expandPath = expandPath;
function sortMap(currMap) {
    currMap[Symbol.iterator] = function* () {
        yield* [...this.entries()].sort((a, b) => a[1] - b[1]);
    };
    return currMap;
}
exports.sortMap = sortMap;
function swapMapValues(currMap) {
    var finalHitMap = [];
    for (var index = 0; index < currMap.length; index++) {
        var currentArray = currMap[index];
        var key = currentArray[0];
        var value = currentArray[1];
        finalHitMap[index] = [value, key];
    }
    return finalHitMap;
}
exports.swapMapValues = swapMapValues;
function printMap(finalMap) {
    for (var j = 0; j < finalMap.length; j++) {
        var curr = finalMap[j];
        if (curr[1].includes('Test') == false && curr[1].includes('test') == false) {
            console.log(curr[0], ' ', curr[1]);
        }
    }
}
exports.printMap = printMap;
function getExtension(filename) {
    var extension = filename.split('.').pop();
    if (extension != undefined) {
        return extension;
    }
    else {
        return 'undefined';
    }
}
exports.getExtension = getExtension;
function main() {
    var argument = process.argv;
    var hitMap = new Map();
    for (var x = 2; x < argument.length; x++) {
        const opts = new find_2.DefaultOpts();
        var myArgs = argument[x];
        var fileMap = find_1.Search.findFilesRecursively(myArgs, opts);
        initializeTypescriptMapFiles(fileMap, hitMap);
        for (var i = 0; i < fileMap.length; i++) {
            var file = fileMap[i];
            var initialFileName = file.name;
            var initialFilePath = file.path;
            var ext = getExtension(initialFileName);
            if (file.name.includes('test.ts') || file.name.includes('.d.ts')) {
                continue;
            }
            else if (['ts', 'tsx'].includes(ext)) {
                const data = fs.readFileSync(initialFilePath, 'utf8');
                const lines = data.split(/\r?\n/);
                const re = /import(?:["'\s]*([\w*{}\n\r\t, ]+)from\s*)?["'\s].*([@\w_-]+)["'\s].*;$/;
                lines.forEach((line) => {
                    var importLine = line.match(re);
                    if (importLine != null) {
                        var importVal = importLine[0];
                        var filePath = importVal.split(' ').pop();
                        var fullPath;
                        if (filePath != undefined) {
                            if (filePath.includes('./') || filePath.includes('../')) {
                                filePath = expandPath(filePath);
                                var fullDirectory = path.dirname(initialFilePath);
                                fullPath = path.resolve(fullDirectory, filePath);
                                fullPath = checkFullPath(fullPath);
                            }
                        }
                        if (fullPath != undefined) {
                            updateHitMap(fullPath, hitMap);
                        }
                    }
                });
            }
        }
    }
    hitMap = sortMap(hitMap);
    var updatedHitMap = [...hitMap];
    var finalMap = swapMapValues(updatedHitMap);
    printMap(finalMap);
}
exports.main = main;
main();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiU2VhcmNoLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiU2VhcmNoLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUNBLHVDQUF5QjtBQUN6QiwyQ0FBNkI7QUFDN0IsaUNBQXFDO0FBQ3JDLGlDQUFtQztBQU9uQyxTQUFnQiw0QkFBNEIsQ0FBRSxJQUEyQixFQUFFLE9BQTRCO0lBQ25HLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFFO1FBQ2xDLElBQUksT0FBTyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksS0FBSyxFQUFFO1lBQ3BDLElBQUksSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsU0FBUyxDQUFDLElBQUssSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLEVBQUU7Z0JBQ3JFLFNBQVM7YUFDWjtpQkFFSSxJQUFJLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsRUFBRSxLQUFLLElBQUksSUFBSSxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLEVBQUUsS0FBSyxLQUFLLEVBQUU7Z0JBRXhGLE9BQU8sQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDLENBQUMsQ0FBQzthQUNoQztTQUNKO0tBQ0o7QUFDTCxDQUFDO0FBYkQsb0VBYUM7QUFPRCxTQUFnQixZQUFZLENBQUUsWUFBcUIsRUFBRSxPQUE0QjtJQUM3RSxJQUFJLFlBQVksSUFBSSxTQUFTLEVBQUU7UUFFM0IsSUFBSSxPQUFPLENBQUMsR0FBRyxDQUFD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LCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgRXJybm9FeGNlcHRpb24gPSBOb2RlSlMuRXJybm9FeGNlcHRpb247XG5pbXBvcnQgKiBhcyBmcyBmcm9tIFwiZnNcIjtcbmltcG9ydCAqIGFzIHBhdGggZnJvbSAncGF0aCc7XG5pbXBvcnQge1NlYXJjaCwgSUZpbGV9IGZyb20gXCIuL2ZpbmRcIjtcbmltcG9ydCB7RGVmYXVsdE9wdHN9IGZyb20gXCIuL2ZpbmRcIjtcblxuLyoqXG4gKiBpdGVyYXRlcyB0aHJvdWdoIGVhY2ggZmlsZSBpbiB0aGUgZGlyZWN0b3J5IGFuZCBhZGRzIHRvIHRoZSBtYXBcbiAqIEBwYXJhbSBkYXRhIFxuICogQHBhcmFtIGN1cnJNYXAgXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBpbml0aWFsaXplVHlwZXNjcmlwdE1hcEZpbGVzIChkYXRhIDogUmVhZG9ubHlBcnJheTxJRmlsZT4sIGN1cnJNYXAgOiBNYXA8c3RyaW5nLG51bWJlcj4pIHtcbiAgICBmb3IgKHZhciBrID0gMDsgayA8IGRhdGEubGVuZ3RoOyBrKyspIHtcbiAgICAgICAgaWYgKGN1cnJNYXAuaGFzKGRhdGFba10ucGF0aCkgPT0gZmFsc2UpIHtcbiAgICAgICAgICAgIGlmIChkYXRhW2tdLm5hbWUuaW5jbHVkZXMoJ3Rlc3QudHMnKSAgfHwgZGF0YVtrXS5uYW1lLmluY2x1ZGVzKCcuZC50cycpKSB7XG4gICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLy8gY2hlY2tzIHRvIG1ha2Ugc3VyZSB0aGF0IHRoZSBmaWxlIHR5cGUgaXMgZWl0aGVyIC50cyBvciAudHN4XG4gICAgICAgICAgICBlbHNlIGlmIChkYXRhW2tdLm5hbWUuc3BsaXQoJy4nKS5wb3AoKSA9PT0gJ3RzJyB8fCBkYXRhW2tdLm5hbWUuc3BsaXQoJy4nKS5wb3AoKSA9PT0gJ3RzeCcpIHtcbiAgICAgICAgICAgICAgICAvLy8gaW5pdGlhbGl6ZXMgaGl0TWFwXG4gICAgICAgICAgICAgICAgY3Vyck1hcC5zZXQoZGF0YVtrXS5wYXRoLCAwKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBcbiAgICB9XG59XG5cbi8qKlxuICogdXBkYXRlcyB0aGUgdmFsdWUgb2YgdGhlIGZpbGUgaW4gdGhlIGhpdE1hcFxuICogQHBhcmFtIGN1cnJGdWxsUGF0aCBcbiAqIEBwYXJhbSBjdXJyTWFwIFxuICovXG5leHBvcnQgZnVuY3Rpb24gdXBkYXRlSGl0TWFwIChjdXJyRnVsbFBhdGggOiBzdHJpbmcsIGN1cnJNYXAgOiBNYXA8c3RyaW5nLG51bWJlcj4pIHtcbiAgICBpZiAoY3VyckZ1bGxQYXRoICE9IHVuZGVmaW5lZCkge1xuICAgICAgICAvLy8gY2hlY2tzIHRvIHNlZSBpZiB0aGUgaGl0bWFwIGFscmVhZHkgaGFzIHRoYXQgcGF0aFxuICAgICAgICBpZiAoY3Vyck1hcC5oYXMoY3VyckZ1bGxQYXRoKSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgLy8vIGlmIGl0IGRvZXMgdGhlbiBpbmNyZW1lbnRzIHRoZSB2YWx1ZSBvZiB0aGF0IGZpbGUgYnkgMVxuICAgICAgICAgICAgdmFyIGN1cnJWYWwgPSBjdXJyTWFwLmdldChjdXJyRnVsbFBhdGgpO1xuICAgICAgICAgICAgaWYgKGN1cnJWYWwgIT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgY3Vyck1hcC5zZXQoY3VyckZ1bGxQYXRoLCBjdXJyVmFsICsgMSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgLy8vIGlmIHRoZSBoaXRtYXAgZG9lcyBub3QgaGF2ZSB0aGF0IHBhdGggYXMgYSBrZXkgYWxyZWFkeVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIC8vLyB0aGVuIHNldHMgdGhhdCBmaWxlIHBhdGggdG8gaGF2ZSBhIHZhbHVlIG9mIDFcbiAgICAgICAgICAgIGN1cnJNYXAuc2V0KGN1cnJGdWxsUGF0aCwgMSk7XG4gICAgICAgIH1cbiAgICB9XG59XG5cbi8qKlxuICogY2hlY2tzIHRvIG1ha2Ugc3VyZSB0aGF0IHRoZSBwYXRoIGV4aXN0cyAgICAgICAgICAgICAgICAgICAgICAgICBcbiAqIEBwYXJhbSBmaW5hbFBhdGggXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjaGVja0Z1bGxQYXRoIChmaW5hbFBhdGggOiBzdHJpbmcpIDogc3RyaW5nIHtcbiAgICBpZiAoZnMuZXhpc3RzU3luYyhmaW5hbFBhdGgpID09IGZhbHNlKSB7XG4gICAgICAgIGZpbmFsUGF0aCA9IGZpbmFsUGF0aCArICd4JztcbiAgICAgICAgaWYgKGZzLmV4aXN0c1N5bmMoZmluYWxQYXRoKSA9PSBmYWxzZSkge1xuICAgICAgICAgICAgZmluYWxQYXRoID0gZmluYWxQYXRoLnJlcGxhY2UoZmluYWxQYXRoLnN1YnN0cmluZyhmaW5hbFBhdGgubGVuZ3RoLTMpLCBcIlwiKTtcbiAgICAgICAgICAgIGZpbmFsUGF0aCA9IGZpbmFsUGF0aCArICdkLnRzJztcbiAgICAgICAgICAgIGlmIChmaW5hbFBhdGguaW5jbHVkZXMoJ3V0aWxzLmpzLmQudHMnKSkge1xuICAgICAgICAgICAgICAgIGZpbmFsUGF0aCA9IGZpbmFsUGF0aC5yZXBsYWNlKGZpbmFsUGF0aC5zdWJzdHJpbmcoZmluYWxQYXRoLmxlbmd0aC03KSwgXCJcIik7XG4gICAgICAgICAgICAgICAgZmluYWxQYXRoID0gZmluYWxQYXRoICsgJ3RzJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChmcy5leGlzdHNTeW5jKGZpbmFsUGF0aCkgPT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oXCJGaWxlIGRvZXMgbm90IGV4aXN0OiBcIiArIGZpbmFsUGF0aCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGZpbmFsUGF0aDtcbn1cblxuLyoqXG4gKiBjb252ZXJ0cyB0aGF0IGZpbGUgcGF0aCBpbnRvIGEgZnVsbCBmaWxlIHBhdGhcbiAqIEBwYXJhbSBjdXJyUGF0aCBcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGV4cGFuZFBhdGggKGN1cnJQYXRoIDogc3RyaW5nKSA6IHN0cmluZyB7XG4gICAgLy8vIGZpeGVzIHRoZSBwdW5jdHVhdGlvbiBvZiB0aGUgZmlsZSBwYXRoIG9mIHRoZSBpbXBvcnRcbiAgICBjdXJyUGF0aCA9IGN1cnJQYXRoLnJlcGxhY2UoL1snXCJdKy9nLCAnJyk7XG4gICAgaWYgKGN1cnJQYXRoLmluY2x1ZGVzKCcudHMnKSA9PSBmYWxzZSkge1xuICAgICAgICBjdXJyUGF0aCA9IGN1cnJQYXRoLnJlcGxhY2UoY3VyclBhdGguc3Vic3RyaW5nKGN1cnJQYXRoLmxlbmd0aC0xKSwgXCJcIik7XG4gICAgICAgIGN1cnJQYXRoID0gY3VyclBhdGggKyAnLnRzJztcbiAgICB9XG4gICAgcmV0dXJuIGN1cnJQYXRoO1xufVxuXG4vKipcbiAqIFNvcnRzIHRoZSBtYXAgaW4gb3JkZXIgYmFzZWQgb24gdGhlIGhpdCB2YWx1ZXMgXG4gKiBAcGFyYW0gY3Vyck1hcCBcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHNvcnRNYXAoY3Vyck1hcCA6IE1hcDxzdHJpbmcsbnVtYmVyPikgOiBNYXA8c3RyaW5nLG51bWJlcj4ge1xuICAgIGN1cnJNYXBbU3ltYm9sLml0ZXJhdG9yXSA9IGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIHlpZWxkKiBbLi4udGhpcy5lbnRyaWVzKCldLnNvcnQoKGEsIGIpID0+IGFbMV0gLSBiWzFdKTtcbiAgICB9XG4gICAgcmV0dXJuIGN1cnJNYXA7XG59XG5cbi8qKlxuICogc3dhcHMgdGhlIGtleSBhbmQgdGhlIHZhbHVlIG9mIHRoZSBtYXAsIHNvIHRoZSBudW1iZXIgb2YgaGl0cyBpcyBmb3JtYXR0ZWQgdG8gdGhlIGxlZnQgb2YgdGhlIGZ1bGwgZmlsZSBwYXRoXG4gKiBAcGFyYW0gY3Vyck1hcCBcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHN3YXBNYXBWYWx1ZXMoY3Vyck1hcCA6IGFueVtdW10pIDogYW55W11bXSB7XG4gICAgdmFyIGZpbmFsSGl0TWFwID0gW107XG4gICAgZm9yICh2YXIgaW5kZXggPSAwOyBpbmRleCA8IGN1cnJNYXAubGVuZ3RoOyBpbmRleCsrKSB7XG4gICAgICAgIHZhciBjdXJyZW50QXJyYXkgPSBjdXJyTWFwW2luZGV4XTtcbiAgICAgICAgdmFyIGtleSA9IGN1cnJlbnRBcnJheVswXTtcbiAgICAgICAgdmFyIHZhbHVlID0gY3VycmVudEFycmF5WzFdO1xuICAgICAgICBmaW5hbEhpdE1hcFtpbmRleF0gPSBbdmFsdWUsIGtleV07XG4gICAgfVxuICAgIHJldHVybiBmaW5hbEhpdE1hcDtcbn1cblxuLyoqXG4gKiBwcmludHMgb3V0IHRoZSBmaW5hbCBNYXBcbiAqIEBwYXJhbSBmaW5hbE1hcCBcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHByaW50TWFwKGZpbmFsTWFwIDogYW55W11bXSkge1xuICAgIGZvciAodmFyIGogPSAwOyBqIDwgZmluYWxNYXAubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgdmFyIGN1cnIgPSBmaW5hbE1hcFtqXTtcbiAgICAgICAgaWYgKGN1cnJbMV0uaW5jbHVkZXMoJ1Rlc3QnKSA9PSBmYWxzZSAmJiBjdXJyWzFdLmluY2x1ZGVzKCd0ZXN0JykgPT0gZmFsc2UpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGN1cnJbMF0sICcgJywgY3VyclsxXSk7XG4gICAgICAgIH1cbiAgICB9XG59XG5cbi8qKlxuICogZ2V0cyB0aGUgZXh0ZW5zaW9uIG9mIHRoZSBmaWxlbmFtZVxuICogQHBhcmFtIGZpbGVuYW1lIFxuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0RXh0ZW5zaW9uIChmaWxlbmFtZSA6IHN0cmluZykgOiBzdHJpbmcge1xuICAgIHZhciBleHRlbnNpb24gPSBmaWxlbmFtZS5zcGxpdCgnLicpLnBvcCgpO1xuICAgIGlmIChleHRlbnNpb24gIT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHJldHVybiBleHRlbnNpb247XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICByZXR1cm4gJ3VuZGVmaW5lZCc7XG4gICAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gbWFpbigpIHtcbiAgICAvLy8gdXNlcyBwcm9jZXNzLmFyZ3YgdG8gc2VlIHRha2UgaW4gYW55IG51bWJlciBvZiBkaXJlY3RvcmllcyBpbiB0aGUgY29tbWFuZCBsaW5lXG4gICAgLy8vIGV4YW1wbGU6IG5vZGUgU2VhcmNoLmpzIC9Vc2Vycy9taWhpcm1hY3BybzEzL0RvY3VtZW50cy9HaXRIdWIvcG9sYXItYm9va3NoZWxmL3dlYi9qcyAvVXNlcnMvbWloaXJtYWNwcm8xMy9Eb2N1bWVudHMvR2l0SHViL3BvbGFyLWJvb2tzaGVsZi9hcHBzXG4gICAgdmFyIGFyZ3VtZW50ID0gcHJvY2Vzcy5hcmd2O1xuICAgIC8vLyBjcmVhdGVzIGFuIGVtcHR5IG1hcFxuICAgIHZhciBoaXRNYXAgPSBuZXcgTWFwKCk7XG4gICAgZm9yICh2YXIgeCA9IDI7IHggPCBhcmd1bWVudC5sZW5ndGg7IHgrKykge1xuICAgICAgICBjb25zdCBvcHRzID0gbmV3IERlZmF1bHRPcHRzKCk7XG4gICAgICAgIHZhciBteUFyZ3MgPSBhcmd1bWVudFt4XTtcbiAgICAgICAgLy8vIHJldHVybnMgYW4gYXJyYXkgd2l0aCBhbGwgdGhlIGZpbGVzIGluIHRoZSBkaXJlY3RvcnlcbiAgICAgICAgdmFyIGZpbGVNYXAgPSBTZWFyY2guZmluZEZpbGVzUmVjdXJzaXZlbHkobXlBcmdzLCBvcHRzKTtcbiAgICAgICAgLy8vIGl0ZXJhdGVzIHRocm91Z2ggZWFjaCBmaWxlIGluIHRoZSBkaXJlY3RvcnkgYW5kIGFkZHMgdG8gdGhlIG1hcFxuICAgICAgICBpbml0aWFsaXplVHlwZXNjcmlwdE1hcEZpbGVzKGZpbGVNYXAsIGhpdE1hcCk7XG5cbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBmaWxlTWFwLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAvLy8gbWFwIG9mIHRoZSBmaWxlIHR5cGUsIG5hbWUsIHBhdGggXG4gICAgICAgICAgICB2YXIgZmlsZSA9IGZpbGVNYXBbaV07XG4gICAgICAgICAgICB2YXIgaW5pdGlhbEZpbGVOYW1lID0gZmlsZS5uYW1lO1xuICAgICAgICAgICAgdmFyIGluaXRpYWxGaWxlUGF0aCA9IGZpbGUucGF0aDtcbiAgICAgICAgICAgIHZhciBleHQgPSBnZXRFeHRlbnNpb24oaW5pdGlhbEZpbGVOYW1lKTtcblxuICAgICAgICAgICAgLy8vIGNoZWNrcyB0byBzZWUgaWYgdGhlIGZpbGUgbmFtZSBpcyB0ZXN0LnRzXG4gICAgICAgICAgICAvLy8gaWYgaXQgaXMgdGhlbiBjb250aW51ZXMgdG8gdGhlIG5leHQgZmlsZVxuICAgICAgICAgICAgaWYgKGZpbGUubmFtZS5pbmNsdWRlcygndGVzdC50cycpICB8fCBmaWxlLm5hbWUuaW5jbHVkZXMoJy5kLnRzJykpIHtcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vLyBjaGVja3MgdG8gbWFrZSBzdXJlIHRoYXQgdGhlIGZpbGUgdHlwZSBpcyBlaXRoZXIgLnRzIG9yIC50c3hcbiAgICAgICAgICAgIGVsc2UgaWYgKFsndHMnLCd0c3gnXS5pbmNsdWRlcyhleHQpKSB7XG4gICAgICAgICAgICAgICAgLy8vIGdldHMgYWxsIHRoZSBjb250ZW50cyBvZiB0aGUgY3VycmVudCBmaWxlXG4gICAgICAgICAgICAgICAgY29uc3QgZGF0YSA9IGZzLnJlYWRGaWxlU3luYyhpbml0aWFsRmlsZVBhdGgsJ3V0ZjgnKTtcbiAgICAgICAgICAgICAgICAvLy8gc3BsaXRzIGVhY2ggbGluZSBvZiBkYXRhIHRvIGFsbG93IHVzIHRvIHBhcnNlIHRocm91Z2ggZWFjaCBvbmVcbiAgICAgICAgICAgICAgICBjb25zdCBsaW5lcyA9IGRhdGEuc3BsaXQoL1xccj9cXG4vKTtcbiAgICAgICAgICAgICAgICAvLy8gY3JlYXRlcyBhIHJlZ3VsYXIgZXhwcmVzc2lvbiBmb3IgdGhlIGltcG9ydCBsaW5lc1xuICAgICAgICAgICAgICAgIGNvbnN0IHJlID0gL2ltcG9ydCg/OltcIidcXHNdKihbXFx3Knt9XFxuXFxyXFx0LCBdKylmcm9tXFxzKik/W1wiJ1xcc10uKihbQFxcd18tXSspW1wiJ1xcc10uKjskLztcbiAgICAgICAgICAgICAgICAvLy8gaXRlcmF0ZXMgdGhyb3VnaCBlYWNoIGxpbmUgb2YgdGhlIGZpbGVcbiAgICAgICAgICAgICAgICBsaW5lcy5mb3JFYWNoKChsaW5lKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIC8vLyBjaGVja3MgdG8gc2VlIGlmIHRoZSBsaW5lIG1hdGNoZXMgdGhlIGZvcm1hdCBvZiB0aGUgcmVndWxhciBleHByZXNzaW9uXG4gICAgICAgICAgICAgICAgICAgIHZhciBpbXBvcnRMaW5lID0gbGluZS5tYXRjaChyZSk7XG4gICAgICAgICAgICAgICAgICAgIC8vLyBtYWtlcyBzdXJlIHRoYXQgdGhlIGxpbmUgYWN0dWFsbHkgaGFzIHRoZSBwcm9wZXIgZm9ybWF0IG9mIHRoZSByZWdFeFxuICAgICAgICAgICAgICAgICAgICBpZiAoaW1wb3J0TGluZSAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLy8gZ2V0cyB0aGUgZW50aXJlIGltcG9ydCBsaW5lcyBjb250ZW50c1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGltcG9ydFZhbCA9IGltcG9ydExpbmVbMF07XG4gICAgICAgICAgICAgICAgICAgICAgICAvLy8gc3BsaXRzIHRoZSBsaW5lIGJhc2VkIG9mZiBzcGFjZXMgYW5kIGdldHMgb25seSB0aGUgZmlsZSBwYXRoXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZmlsZVBhdGggPSBpbXBvcnRWYWwuc3BsaXQoJyAnKS5wb3AoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmdWxsUGF0aDtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vLyBjb252ZXJ0cyB0aGF0IGZpbGUgcGF0aCBpbnRvIGEgZnVsbCBmaWxlIHBhdGhcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmaWxlUGF0aCAhPSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZmlsZVBhdGguaW5jbHVkZXMoJy4vJykgfHwgZmlsZVBhdGguaW5jbHVkZXMoJy4uLycpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVQYXRoID0gZXhwYW5kUGF0aChmaWxlUGF0aCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vLyBjcmVhdGVzIHRoZSBmdWxsIHBhdGggd2l0aCB0aGUgcHJvcGVyIGRpcmVjdG9yeSBuYW1lXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmdWxsRGlyZWN0b3J5ID0gcGF0aC5kaXJuYW1lKGluaXRpYWxGaWxlUGF0aCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bGxQYXRoID0gcGF0aC5yZXNvbHZlKGZ1bGxEaXJlY3RvcnksIGZpbGVQYXRoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVsbFBhdGggPSBjaGVja0Z1bGxQYXRoKGZ1bGxQYXRoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZnVsbFBhdGggIT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8vIHVwZGF0ZXMgdGhlIHZhbHVlIG9mIHRoZSBmaWxlIGluIHRoZSBoaXRNYXBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVIaXRNYXAoZnVsbFBhdGgsIGhpdE1hcCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICAvLy8gc29ydHMgdGhlIG1hcCBiYXNlZCBvbiB2YWx1ZXNcbiAgICBoaXRNYXAgPSBzb3J0TWFwKGhpdE1hcCk7XG4gICAgLy8vIG1ha2VzIHRoZSBtYXAgaW50byBhIHRhYmxlIHR5cGUgZm9ybWF0IHdpdGggYSBuZXN0ZWQgYXJyYXlcbiAgICB2YXIgdXBkYXRlZEhpdE1hcCA9IFsuLi5oaXRNYXBdO1xuICAgIC8vLyBzd2FwcyB0aGUga2V5IGFuZCB2YWx1ZVxuICAgIHZhciBmaW5hbE1hcCA9IHN3YXBNYXBWYWx1ZXModXBkYXRlZEhpdE1hcCk7XG4gICAgLy8vIHByaW50cyB0aGUgbWFwIG91dCBpbiB0YWJsZSBmb3JtYXQgKGZvcm1hdDogaGl0VmFsdWUgLi4uIFt0YWJdIC4uLiBQYXRoKVxuICAgIHByaW50TWFwKGZpbmFsTWFwKTtcbn1cblxuLy8vIHJ1bnMgdGhlIG1haW4gZnVuY3Rpb24gYW5kIHByaW50cyBvdXQgdGhlIHRhYmxlIHdpdGggdGhlIG51bWJlciBvZiBoaXRzIGFzIHRoZSBrZXkgYW5kIHRoZSBwYXRoIGFzIHRoZSB2YWx1ZVxubWFpbigpOyAiXX0=