"use strict";
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];
    result["default"] = mod;
    return result;
};
Object.defineProperty(exports, "__esModule", { value: true });
const libpath = __importStar(require("path"));
const fs = __importStar(require("fs"));
const FilePaths_1 = require("polar-shared/src/util/FilePaths");
const readline = __importStar(require("readline"));
class Search {
    static find(dir, opts = new DefaultOpts()) {
        const files = fs.readdirSync(dir);
        const result = [];
        for (const name of files) {
            const createType = () => {
                if (stat.isDirectory()) {
                    return 'directory';
                }
                if (stat.isFile()) {
                    return 'file';
                }
                return undefined;
            };
            const type = createType();
            if (!type) {
                continue;
            }
            const createRecord = () => {
                return { type, name, path };
            };
            const file = createRecord();
            const path = libpath.join(dir, name);
            const stat = fs.statSync(path);
            const acceptFile = () => {
                const acceptExtension = () => {
                    if (!opts.extensions) {
                        return true;
                    }
                    const ext = FilePaths_1.FilePaths.toExtension(path).getOrUndefined();
                    return ext && opts.extensions.includes(ext);
                };
                const acceptType = () => {
                    if (!opts.types) {
                        return true;
                    }
                    return opts.types.includes(type);
                };
                return acceptExtension() && acceptType();
            };
            if (acceptFile()) {
                result.push(file);
            }
            if (opts.recurse && type === 'directory') {
                result.push(...this.find(path, opts));
            }
        }
        return result;
    }
}
exports.Search = Search;
class DefaultOpts {
    constructor() {
        this.recurse = true;
        this.types = ['file'];
    }
}
let hitMap = new Map();
let opts = new DefaultOpts();
let rl = readline.createInterface({
    input: process.stdin,
    output: process.stdout
});
rl.question('Enter the directory to be parsed through: ', (currDirectory) => {
    currDirectory.toLowerCase();
    for (var file in Search.find(currDirectory, opts)) {
        if (file.split('.').pop() === 'ts' || file.split('.').pop() === 'tsx') {
            const data = fs.readFileSync(file, 'utf8');
            const lines = data.split(/\r?\n/);
            let re = `import(?:["'\s]*([\w*{}\n\r\t, ]+)from\s*)?["'\s].*([@\w_-]+)["'\s].*;$`;
            lines.forEach((line) => {
                let importLine = line.match(re);
                if (importLine != null) {
                    let importVal = importLine[1];
                    let filePath = importVal.split(' ').pop();
                    var fullPath = currDirectory + filePath;
                    if (hitMap.has(fullPath) === true) {
                        var currVal = hitMap.get(fullPath);
                        hitMap.set(fullPath, currVal + 1);
                    }
                    else {
                        hitMap.set(fullPath, 1);
                    }
                }
            });
        }
    }
    rl.close();
});
console.log(hitMap);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiU2VhcmNoLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiU2VhcmNoLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQVNBLDhDQUFnQztBQUNoQyx1Q0FBeUI7QUFDekIsK0RBQTBEO0FBRTFELG1EQUFxQztBQUVyQyxNQUFhLE1BQU07SUFDUixNQUFNLENBQUMsSUFBSSxDQUFDLEdBQVcsRUFBRSxPQUFhLElBQUksV0FBVyxFQUFFO1FBQzFELE1BQU0sS0FBSyxHQUFHLEVBQUUsQ0FBQyxXQUFXLENBQUMsR0FBRyxDQUFDLENBQUM7UUFFbEMsTUFBTSxNQUFNLEdBQVksRUFBRSxDQUFDO1FBRTNCLEtBQUssTUFBTSxJQUFJLElBQUksS0FBSyxFQUFFO1lBRXRCLE1BQU0sVUFBVSxHQUFHLEdBQXlCLEVBQUU7Z0JBQzFDLElBQUksSUFBSSxDQUFDLFdBQVcsRUFBRSxFQUFFO29CQUNwQixPQUFPLFdBQVcsQ0FBQztpQkFDdEI7Z0JBRUQsSUFBSSxJQUFJLENBQUMsTUFBTSxFQUFFLEVBQUU7b0JBQ2YsT0FBTyxNQUFNLENBQUM7aUJBQ2pCO2dCQUNELE9BQU8sU0FBUyxDQUFDO1lBQ3JCLENBQUMsQ0FBQztZQUNGLE1BQU0sSUFBSSxHQUFHLFVBQVUsRUFBRSxDQUFDO1lBQzFCLElBQUksQ0FBRSxJQUFJLEVBQUU7Z0JBQ1IsU0FBUzthQUNaO1lBQ0QsTUFBTSxZQUFZLEdBQUcsR0FBVSxFQUFFO2dCQUM3QixPQUFPLEVBQUMsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUMsQ0FBQztZQUM5QixDQUFDLENBQUM7WUFFRixNQUFNLElBQUksR0FBRyxZQUFZLEVBQUUsQ0FBQztZQUM1QixNQUFNLElBQUksR0FBRyxPQUFPLENBQUMsSUFBSSxDQUFDLEdBQUcsRUFBRSxJQUFJLENBQUMsQ0FBQztZQUNyQyxNQUFNLElBQUksR0FBRyxFQUFFLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBSy9CLE1BQU0sVUFBVSxHQUFH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LElBQUksTUFBTSxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsS0FBSyxJQUFJLEVBQUU7d0JBRS9CLElBQUksT0FBTyxHQUFHLE1BQU0sQ0FBQyxHQUFHLENBQUMsUUFBUSxDQUFDLENBQUM7d0JBQ25DLE1BQU0sQ0FBQyxHQUFHLENBQUMsUUFBUSxFQUFFLE9BQU8sR0FBRyxDQUFDLENBQUMsQ0FBQztxQkFDckM7eUJBRUk7d0JBRUQsTUFBTSxDQUFDLEdBQUcsQ0FBQyxRQUFRLEVBQUUsQ0FBQyxDQUFDLENBQUM7cUJBQzNCO2lCQUNKO1lBQ0wsQ0FBQyxDQUFDLENBQUM7U0FDTjtLQUNKO0lBQ0QsRUFBRSxDQUFDLEtBQUssRUFBRSxDQUFDO0FBQ2YsQ0FBQyxDQUFDLENBQUM7QUFFSCxPQUFPLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgICBJU09EYXRlU3RyaW5nLFxuICAgIElTT0RhdGVUaW1lU3RyaW5nLFxuICAgIElTT0RhdGVZZWFyTW9udGhTdHJpbmcsXG4gICAgSVNPRGF0ZVllYXJTdHJpbmcsXG59IGZyb20gXCJwb2xhci1zaGFyZWQvc3JjL21ldGFkYXRhL0lTT0RhdGVUaW1lU3RyaW5nc1wiO1xuaW1wb3J0IHtET0lTdHJ9IGZyb20gXCJwb2xhci1zaGFyZWQvc3JjL3V0aWwvU3RyaW5nc1wiO1xuXG5pbXBvcnQgRXJybm9FeGNlcHRpb24gPSBOb2RlSlMuRXJybm9FeGNlcHRpb247XG5pbXBvcnQgKiBhcyBsaWJwYXRoIGZyb20gXCJwYXRoXCI7XG5pbXBvcnQgKiBhcyBmcyBmcm9tIFwiZnNcIjtcbmltcG9ydCB7RmlsZVBhdGhzfSBmcm9tIFwicG9sYXItc2hhcmVkL3NyYy91dGlsL0ZpbGVQYXRoc1wiO1xuaW1wb3J0IHtQYXRoU3RyfSBmcm9tIFwicG9sYXItc2hhcmVkL3NyYy91dGlsL1N0cmluZ3NcIjtcbmltcG9ydCAqIGFzIHJlYWRsaW5lIGZyb20gJ3JlYWRsaW5lJztcblxuZXhwb3J0IGNsYXNzIFNlYXJjaCB7XG4gICAgcHVibGljIHN0YXRpYyBmaW5kKGRpcjogc3RyaW5nLCBvcHRzOiBPcHRzID0gbmV3IERlZmF1bHRPcHRzKCkpOiBSZWFkb25seUFycmF5PElGaWxlPiB7XG4gICAgICAgIGNvbnN0IGZpbGVzID0gZnMucmVhZGRpclN5bmMoZGlyKTtcblxuICAgICAgICBjb25zdCByZXN1bHQ6IElGaWxlW10gPSBbXTtcblxuICAgICAgICBmb3IgKGNvbnN0IG5hbWUgb2YgZmlsZXMpIHtcblxuICAgICAgICAgICAgY29uc3QgY3JlYXRlVHlwZSA9ICgpOiBGaWxlVHlwZSB8IHVuZGVmaW5lZCA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHN0YXQuaXNEaXJlY3RvcnkoKSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ2RpcmVjdG9yeSc7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKHN0YXQuaXNGaWxlKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdmaWxlJztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBjb25zdCB0eXBlID0gY3JlYXRlVHlwZSgpO1xuICAgICAgICAgICAgaWYgKCEgdHlwZSkge1xuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgY3JlYXRlUmVjb3JkID0gKCk6IElGaWxlID0+IHtcbiAgICAgICAgICAgICAgICByZXR1cm4ge3R5cGUsIG5hbWUsIHBhdGh9O1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgY29uc3QgZmlsZSA9IGNyZWF0ZVJlY29yZCgpO1xuICAgICAgICAgICAgY29uc3QgcGF0aCA9IGxpYnBhdGguam9pbihkaXIsIG5hbWUpO1xuICAgICAgICAgICAgY29uc3Qgc3RhdCA9IGZzLnN0YXRTeW5jKHBhdGgpO1xuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIFJldHVybiB0cnVlIGlmIHdlIHNob3VsZCBhY2NlcHQgdGhlIGZpbGUuXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIGNvbnN0IGFjY2VwdEZpbGUgPSAoKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgYWNjZXB0RXh0ZW5zaW9uID0gKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAoISBvcHRzLmV4dGVuc2lvbnMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGV4dCA9IEZpbGVQYXRocy50b0V4dGVuc2lvbihwYXRoKS5nZXRPclVuZGVmaW5lZCgpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZXh0ICYmIG9wdHMuZXh0ZW5zaW9ucy5pbmNsdWRlcyhleHQpO1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgY29uc3QgYWNjZXB0VHlwZSA9ICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCEgb3B0cy50eXBlcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9wdHMudHlwZXMuaW5jbHVkZXModHlwZSk7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICByZXR1cm4gYWNjZXB0RXh0ZW5zaW9uKCkgJiYgYWNjZXB0VHlwZSgpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGlmIChhY2NlcHRGaWxlKCkpIHtcbiAgICAgICAgICAgICAgICByZXN1bHQucHVzaChmaWxlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChvcHRzLnJlY3Vyc2UgJiYgdHlwZSA9PT0gJ2RpcmVjdG9yeScpIHtcbiAgICAgICAgICAgICAgICByZXN1bHQucHVzaCguLi50aGlzLmZpbmQocGF0aCwgb3B0cykpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxufVxuXG4vLy8gdGhlIGZpbGUgdHlwZSB0aGF0IGlzIGNvbXBhdGliYWxlXG5leHBvcnQgdHlwZSBGaWxlVHlwZSA9ICdmaWxlJyB8ICdkaXJlY3RvcnknO1xuLy8vIEEgZmlsZSBleHRlbnNpb24gd2l0aG91dCB0aGUgJy4nIHByZWZpeC4gIEV4YW1wbGU6IGpwZywganBlZywgdHh0XG5leHBvcnQgdHlwZSBGaWxlRXh0ID0gc3RyaW5nO1xuXG5jbGFzcyBEZWZhdWx0T3B0cyBpbXBsZW1lbnRzIE9wdHMge1xuICAgIHB1YmxpYyByZWFkb25seSByZWN1cnNlID0gdHJ1ZTtcbiAgICBwdWJsaWMgcmVhZG9ubHkgdHlwZXM6IFJlYWRvbmx5QXJyYXk8RmlsZVR5cGU+ID0gWydmaWxlJ107XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgT3B0cyB7XG4gICAgcmVhZG9ubHkgcmVjdXJzZT86IGJvb2xlYW47XG4gICAgLy8vIE9ubHkgYWNjZXB0IHRoZSBnaXZlbiBmaWxlIHR5cGVzLiAgQnkgZGVmYXVsdCBhbGwgdHlwZXMgYXJlIGFjY2VwdGVkLlxuICAgIHJlYWRvbmx5IHR5cGVzPzogUmVhZG9ubHlBcnJheTxGaWxlVHlwZT47IFxuICAgIC8vLyBPbmx5IGFjY2VwdCB0aGUgZ2l2ZW4gZXh0ZW5zaW9ucy4gQnkgZGVmYXVsdCBhbGwgZXh0ZW5zaW9uIGFyZSBhY2NlcHRlZC5cbiAgICByZWFkb25seSBleHRlbnNpb25zPzogUmVhZG9ubHlBcnJheTxGaWxlRXh0PjsgXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgSUZpbGUge1xuICAgIHJlYWRvbmx5IG5hbWU6IHN0cmluZzsgXG4gICAgcmVhZG9ubHkgcGF0aDogUGF0aFN0cjsgLy8vIHRoZSBlbnRpcmUgcGF0aCBvZiB0aGUgZmlsZVxuICAgIHJlYWRvbmx5IHR5cGU6IEZpbGVUeXBlOyAvLy8gd2hhdCB0eXBlIHRoZSBmaWxlIGlzXG59XG5cbi8vLyBjcmVhdGVzIGFuIGVtcHR5IG1hcFxubGV0IGhpdE1hcCA9IG5ldyBNYXAoKTtcbmxldCBvcHRzID0gbmV3IERlZmF1bHRPcHRzKCk7XG4vLy8gYWxsb3dzIHVzIHRvIHRha2UgdXNlciBpbnB1dFxubGV0IHJsID0gcmVhZGxpbmUuY3JlYXRlSW50ZXJmYWNlKHtcbiAgICBpbnB1dDogcHJvY2Vzcy5zdGRpbixcbiAgICBvdXRwdXQ6IHByb2Nlc3Muc3Rkb3V0XG59KTtcblxuLy8gYXNrcyB1c2VyIHRvIHNlZSB3aGljaCBkaXJlY3RvcnkgdG8gcGFyc2UgdGhyb3VnaFxucmwucXVlc3Rpb24oJ0VudGVyIHRoZSBkaXJlY3RvcnkgdG8gYmUgcGFyc2VkIHRocm91Z2g6ICcsIChjdXJyRGlyZWN0b3J5KSA9PiB7XG4gICAgLy8vIGNvbnZlcnRzIGVudGlyZSBkaXJlY3RvcnkgbmFtZSB0byBsb3dlcmNhc2VcbiAgICBjdXJyRGlyZWN0b3J5LnRvTG93ZXJDYXNlKCk7XG4gICAgLy8vIFNlYXJjaC5maW5kIHJldHVybnMgYW4gYXJyYXkgd2l0aCBhbGwgdGhlIGZpbGVzIGluIHRoZSBkaXJlY3RvcnlcbiAgICAvLy8gaXRlcmF0ZXMgdGhyb3VnaCBlYWNoIGZpbGUgaW4gdGhlIGRpcmVjdG9yeVxuICAgIGZvciAodmFyIGZpbGUgaW4gU2VhcmNoLmZpbmQoY3VyckRpcmVjdG9yeSwgb3B0cykpIHtcbiAgICAgICAgLy8vIGNoZWNrcyB0byBtYWtlIHN1cmUgdGhhdCB0aGUgZmlsZSB0eXBlIGlzIGVpdGhlciAudHMgb3IgLnRzeFxuICAgICAgICBpZiAoZmlsZS5zcGxpdCgnLicpLnBvcCgpID09PSAndHMnIHx8IGZpbGUuc3BsaXQoJy4nKS5wb3AoKSA9PT0gJ3RzeCcpIHtcbiAgICAgICAgICAgIC8vLyBnZXRzIGFsbCB0aGUgY29udGVudHMgb2YgdGhlIGN1cnJlbnQgZmlsZVxuICAgICAgICAgICAgY29uc3QgZGF0YSA9IGZzLnJlYWRGaWxlU3luYyhmaWxlLCd1dGY4Jyk7XG4gICAgICAgICAgICAvLy8gc3BsaXRzIGVhY2ggbGluZSBvZiBkYXRhIHRvIGFsbG93IHVzIHRvIHBhcnNlIHRocm91Z2ggZWFjaCBvbmVcbiAgICAgICAgICAgIGNvbnN0IGxpbmVzID0gZGF0YS5zcGxpdCgvXFxyP1xcbi8pO1xuICAgICAgICAgICAgLy8vIGNyZWF0ZXMgYSByZWd1bGFyIGV4cHJlc3Npb24gZm9yIHRoZSBpbXBvcnQgbGluZXNcbiAgICAgICAgICAgIGxldCByZSA9IGBpbXBvcnQoPzpbXCInXFxzXSooW1xcdyp7fVxcblxcclxcdCwgXSspZnJvbVxccyopP1tcIidcXHNdLiooW0BcXHdfLV0rKVtcIidcXHNdLio7JGA7XG4gICAgICAgICAgICAvLy8gaXRlcmF0ZXMgdGhyb3VnaCBlYWNoIGxpbmUgb2YgdGhlIGZpbGVcbiAgICAgICAgICAgIGxpbmVzLmZvckVhY2goKGxpbmUpID0+IHtcbiAgICAgICAgICAgICAgICAvLy8gY2hlY2tzIHRvIHNlZSBpZiB0aGUgbGluZSBtYXRjaGVzIHRoZSBmb3JtYXQgb2YgdGhlIHJlZ3VsYXIgZXhwcmVzc2lvblxuICAgICAgICAgICAgICAgIGxldCBpbXBvcnRMaW5lID0gbGluZS5tYXRjaChyZSk7XG4gICAgICAgICAgICAgICAgLy8vIG1ha2VzIHN1cmUgdGhhdCB0aGUgbGluZSBhY3R1YWxseSBoYXMgdGhlIHByb3BlciBmb3JtYXQgb2YgdGhlIHJlZ0V4XG4gICAgICAgICAgICAgICAgaWYgKGltcG9ydExpbmUgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICAvLy8gZ2V0cyB0aGUgZW50aXJlIGltcG9ydCBsaW5lcyBjb250ZW50c1xuICAgICAgICAgICAgICAgICAgICBsZXQgaW1wb3J0VmFsID0gaW1wb3J0TGluZVsxXTtcbiAgICAgICAgICAgICAgICAgICAgLy8vIHNwbGl0cyB0aGUgbGluZSBiYXNlZCBvZmYgc3BhY2VzIGFuZCBnZXRzIG9ubHkgdGhlIGZpbGUgcGF0aFxuICAgICAgICAgICAgICAgICAgICBsZXQgZmlsZVBhdGggPSBpbXBvcnRWYWwuc3BsaXQoJyAnKS5wb3AoKTtcbiAgICAgICAgICAgICAgICAgICAgLy8vIGNvbnZlcnRzIHRoYXQgZmlsZSBwYXRoIGludG8gYSBmdWxsIGZpbGUgcGF0aFxuICAgICAgICAgICAgICAgICAgICB2YXIgZnVsbFBhdGggPSBjdXJyRGlyZWN0b3J5ICsgZmlsZVBhdGg7XG4gICAgICAgICAgICAgICAgICAgIC8vLyBjaGVja3MgdG8gc2VlIGlmIHRoZSBoaXRtYXAgYWxyZWFkeSBoYXMgdGhhdCBwYXRoXG4gICAgICAgICAgICAgICAgICAgIGlmIChoaXRNYXAuaGFzKGZ1bGxQYXRoKSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8vIGlmIGl0IGRvZXMgdGhlbiBpbmNyZW1lbnRzIHRoZSB2YWx1ZSBvZiB0aGF0IGZpbGUgYnkgMVxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGN1cnJWYWwgPSBoaXRNYXAuZ2V0KGZ1bGxQYXRoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGhpdE1hcC5zZXQoZnVsbFBhdGgsIGN1cnJWYWwgKyAxKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAvLy8gaWYgdGhlIGhpdG1hcCBkb2VzIG5vdCBoYXZlIHRoYXQgcGF0aCBhcyBhIGtleSBhbHJlYWR5XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8vIHRoZW4gc2V0cyB0aGF0IGZpbGUgcGF0aCB0byBoYXZlIGEgdmFsdWUgb2YgMVxuICAgICAgICAgICAgICAgICAgICAgICAgaGl0TWFwLnNldChmdWxsUGF0aCwgMSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBybC5jbG9zZSgpO1xufSk7XG4vLy8gcHJpbnRzIG91dCB0aGUgaGl0bWFwXG5jb25zb2xlLmxvZyhoaXRNYXApOyJdfQ==