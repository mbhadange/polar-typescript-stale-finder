"use strict";
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];
    result["default"] = mod;
    return result;
};
Object.defineProperty(exports, "__esModule", { value: true });
const libpath = __importStar(require("path"));
const fs = __importStar(require("fs"));
const FilePaths_1 = require("polar-shared/src/util/FilePaths");
const path = __importStar(require("path"));
class Search {
    static find(dir, opts = new DefaultOpts()) {
        const files = fs.readdirSync(dir);
        const result = [];
        for (const name of files) {
            const path = libpath.join(dir, name);
            const stat = fs.statSync(path);
            const createType = () => {
                if (stat.isDirectory()) {
                    return 'directory';
                }
                if (stat.isFile()) {
                    return 'file';
                }
                return undefined;
            };
            const type = createType();
            if (!type) {
                continue;
            }
            const createRecord = () => {
                return { type, name, path };
            };
            const file = createRecord();
            const acceptFile = () => {
                const acceptExtension = () => {
                    if (!opts.extensions) {
                        return true;
                    }
                    const ext = FilePaths_1.FilePaths.toExtension(path).getOrUndefined();
                    return ext && opts.extensions.includes(ext);
                };
                const acceptType = () => {
                    if (!opts.types) {
                        return true;
                    }
                    return opts.types.includes(type);
                };
                return acceptExtension() && acceptType();
            };
            if (acceptFile()) {
                result.push(file);
            }
            if (opts.recurse && type === 'directory') {
                result.push(...this.find(path, opts));
            }
        }
        return result;
    }
}
exports.Search = Search;
class DefaultOpts {
    constructor() {
        this.recurse = true;
        this.types = ['file'];
    }
}
let hitMap = new Map();
let opts = new DefaultOpts();
var myArgs = process.argv[2];
var fileMap = Search.find(myArgs, opts);
for (var i = 0; i < fileMap.length; i++) {
    var file = fileMap[i];
    var initialFileName = file.name;
    var initialFilePath = file.path;
    if (file.name === 'test.ts' || file.name.includes('.d.ts')) {
        continue;
    }
    else if (initialFileName.split('.').pop() === 'ts' || initialFileName.split('.').pop() === 'tsx') {
        const data = fs.readFileSync(initialFilePath, 'utf8');
        const lines = data.split(/\r?\n/);
        let re = /import(?:["'\s]*([\w*{}\n\r\t, ]+)from\s*)?["'\s].*([@\w_-]+)["'\s].*;$/;
        lines.forEach((line) => {
            let importLine = line.match(re);
            if (importLine != null) {
                let importVal = importLine[0];
                let filePath = importVal.split(' ').pop();
                var fullPath;
                if (filePath != undefined) {
                    if (filePath.includes('./') || filePath.includes('../')) {
                        filePath = filePath.replace(/['"]+/g, '');
                        if (filePath.includes('.ts') == false) {
                            filePath = filePath.replace(filePath.substring(filePath.length - 1), "");
                            filePath = filePath + '.ts;';
                        }
                        var fullDirectory = path.basename(initialFilePath);
                        fullPath = path.resolve(fullDirectory, filePath);
                        console.log(fullPath);
                        if (fs.existsSync(fullPath) == false) {
                            console.log("File does not exist!");
                        }
                    }
                }
                if (hitMap.has(fullPath) === true) {
                    var currVal = hitMap.get(fullPath);
                    hitMap.set(fullPath, currVal + 1);
                }
                else {
                    hitMap.set(fullPath, 1);
                }
            }
        });
    }
}
hitMap[Symbol.iterator] = function* () {
    yield* [...this.entries()].sort((a, b) => a[1] - b[1]);
};
var updatedHitMap = [...hitMap];
var finalHitMap = [];
for (var index = 0; index < updatedHitMap.length; index++) {
    var currentArray = updatedHitMap[index];
    var key = currentArray[0];
    var value = currentArray[1];
    finalHitMap[index] = [value, key];
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiU2VhcmNoLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiU2VhcmNoLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUNBLDhDQUFnQztBQUNoQyx1Q0FBeUI7QUFDekIsK0RBQTBEO0FBRTFELDJDQUE2QjtBQUU3QixNQUFhLE1BQU07SUFDUixNQUFNLENBQUMsSUFBSSxDQUFDLEdBQVcsRUFBRSxPQUFhLElBQUksV0FBVyxFQUFFO1FBQzFELE1BQU0sS0FBSyxHQUFHLEVBQUUsQ0FBQyxXQUFXLENBQUMsR0FBRyxDQUFDLENBQUM7UUFFbEMsTUFBTSxNQUFNLEdBQVksRUFBRSxDQUFDO1FBRTNCLEtBQUssTUFBTSxJQUFJLElBQUksS0FBSyxFQUFFO1lBRXRCLE1BQU0sSUFBSSxHQUFHLE9BQU8sQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFLElBQUksQ0FBQyxDQUFDO1lBQ3JDLE1BQU0sSUFBSSxHQUFHLEVBQUUsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUM7WUFFL0IsTUFBTSxVQUFVLEdBQUcsR0FBeUIsRUFBRTtnQkFDMUMsSUFBSSxJQUFJLENBQUMsV0FBVyxFQUFFLEVBQUU7b0JBQ3BCLE9BQU8sV0FBVyxDQUFDO2lCQUN0QjtnQkFFRCxJQUFJLElBQUksQ0FBQyxNQUFNLEVBQUUsRUFBRTtvQkFDZixPQUFPLE1BQU0sQ0FBQztpQkFDakI7Z0JBQ0QsT0FBTyxTQUFTLENBQUM7WUFDckIsQ0FBQyxDQUFDO1lBQ0YsTUFBTSxJQUFJLEdBQUcsVUFBVSxFQUFFLENBQUM7WUFDMUIsSUFBSSxDQUFFLElBQUksRUFBRTtnQkFDUixTQUFTO2FBQ1o7WUFDRCxNQUFNLFlBQVksR0FBRyxHQUFVLEVBQUU7Z0JBQzdCLE9BQU8sRUFBQyxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBQyxDQUFDO1lBQzlCLENBQUMsQ0FBQztZQUVGLE1BQU0sSUFBSSxHQUFHLFlBQVksRUFBRSxDQUFDO1lBSzVCLE1BQU0sVUFBVSxHQUFHLEdBQUcsRUFBRTtnQkFDcEIsTUFBTSxlQUFlLEdBQUcsR0FBRyxFQUFFO29CQUN6QixJQUFJLENBQUUsSUFBSSxDQUFDLFVBQVUsRUFBRTt3QkFDbkIsT0FBTyxJQUFJLENBQUM7cUJBQ2Y7b0JBQ0QsTUFBTSxHQUFHLEdBQUcscUJBQVMsQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLENBQUMsY0FBYyxFQUFFLENBQUM7b0JBQ3pELE9BQU8sR0FBRyxJQUFJLElBQUksQ0FBQyxVQUFVLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxDQUFDO2dCQUNoRCxDQUFDLENBQUM7Z0JBQ0YsTUFBTSxVQUFVLEdBQUcsR0FBRyxFQUFFO29CQUNwQixJQUFJLENBQUUsSUFBSSxDQUFDLEtBQUssRUFBRTt3QkFDZCxPQUFPLElBQUksQ0FBQztxQkFDZjtvQkFDRCxPQUFPLElBQUksQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDO2dCQUNyQyxDQUFDLENBQUM7Z0JBQ0YsT0FBTyxlQUFlLEVBQUUsSUFBSSxVQUFVLEVBQUUsQ0FBQztZQUM3QyxDQUFDLENBQUM7WUFDRixJQUFJLFVBQVUsRUFBRSxFQUFFO2dCQUNkLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7YUFDckI7WUFDRCxJQUFJLElBQUksQ0FBQyxPQUFPLElBQUksSUFBSSxLQUFLLFdBQVcsRUFBRTtnQkFDdEMsTUFBTSxDQUFDLElBQUksQ0FBQyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDLENBQUM7YUFDekM7U0FDSjtRQUNELE9BQU8sTUFBTSxDQUFDO0lBQ2xCLENBQUM7Q0FDSjtBQTNERCx3QkEyREM7QUFPRCxNQUFNLFdBQVc7SUFBakI7UUFDb0IsWUFBTyxHQUFHLElBQUksQ0FBQztRQUNmLFVBQUssR0FBNEIsQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUM5RCxDQUFDO0NBQUE7QUFpQkQsSUFBSSxNQUFNLEdBQUcsSUFBSSxHQUFHLEVBQUUsQ0FBQztBQUN2QixJQUFJLElBQUksR0FBRyxJQUFJLFdBQVcsRUFBRSxDQUFDO0FBTTdCLElBQUksTUFBTSxHQUFHLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFHN0IsSUFBSSxPQUFPLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLENBQUM7QUFDeEMsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLE9BQU8sQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUU7SUFFckMsSUFBSSxJQUFJLEdBQUcsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ3RCLElBQUksZUFBZSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUM7SUFDaEMsSUFBSSxlQUFlLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQztJQUloQyxJQUFJLElBQUksQ0FBQyxJQUFJLEtBQUssU0FBUyxJQUFLLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxFQUFFO1FBQ3pELFNBQVM7S0FDWjtTQUVJLElBQUksZUFBZSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLEVBQUUsS0FBSyxJQUFJLElBQUksZUFBZSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLEVBQUUsS0FBSyxLQUFLLEVBQUU7UUFFOUYsTUFBTSxJQUFJLEdBQUcsRUFBRSxDQUFDLFlBQVksQ0FBQyxlQUFlLEVBQUMsTUFBTSxDQUFDLENBQUM7UUFFckQsTUFBTSxLQUFLLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUVsQyxJQUFJLEVBQUUsR0FBRyx5RUFBeUUsQ0FBQztRQUVuRixLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxFQUFFLEVBQUU7WUFFbkIsSUFBSSxVQUFVLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUVoQyxJQUFJLFVBQVUsSUFBSSxJQUFJLEVBQUU7Z0JBRXBCLElBQUksU0FBUyxHQUFHLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFFOUIsSUFBSSxRQUFRLEdBQUcsU0FBUyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLEVBQUUsQ0FBQztnQkFDMUMsSUFBSSxRQUFRLENBQUM7Z0JBRWIsSUFBSSxRQUFRLElBQUksU0FBUyxFQUFFO29CQUN2QixJQUFJLFFBQVEsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLElBQUksUUFBUSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsRUFBRTt3QkFFckQsUUFBUSxHQUFHLFFBQVEsQ0FBQyxPQUFPLENBQUMsUUFBUSxFQUFFLEVBQUUsQ0FBQyxDQUFDO3dCQUMxQyxJQUFJLFFBQVEsQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLElBQUksS0FBSyxFQUFFOzRCQUNuQyxRQUFRLEdBQUcsUUFBUSxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FBQyxNQUFNLEdBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUM7NEJBQ3ZFLFFBQVEsR0FBRyxRQUFRLEdBQUcsTUFBTSxDQUFDO3lCQUNoQzt3QkFDRCxJQUFJLGFBQWEsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLGVBQWUsQ0FBQyxDQUFDO3dCQUNuRCxRQUFRLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxhQUFhLEVBQUUsUUFBUSxDQUFDLENBQUM7d0JBQ2pELE9BQU8sQ0FBQyxHQUFHLENBQUMsUUFBUSxDQUFDLENBQUM7d0JBQ3RCLElBQUksRUFBRSxDQUFDLFVBQVUsQ0FBQyxRQUFRLENBQUMsSUFBSSxLQUFLLEVBQUU7NEJBQ2xDLE9BQU8sQ0FBQyxHQUFHLENBQUMsc0JBQXNCLENBQUMsQ0FBQzt5QkFDdkM7cUJBQ0o7aUJBQ0o7Z0JBR0QsSUFBSSxNQUFNLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxLQUFLLElBQUksRUFBRTtvQkFFL0IsSUFBSSxPQUFPLEdBQUcsTUFBTSxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsQ0FBQztvQkFDbkMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxRQUFRLEVBQUUsT0FBTyxHQUFHLENBQUMsQ0FBQyxDQUFDO2lCQUNyQztxQkFFSTtvQkFFRCxNQUFNLENBQUMsR0FBRyxDQUFDLFFBQVEsRUFBRSxDQUFDLENBQUMsQ0FBQztpQkFDM0I7YUFDSjtRQUNMLENBQUMsQ0FBQyxDQUFDO0tBQ047Q0FDSjtBQUtELE1BQU0sQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLEdBQUcsUUFBUSxDQUFDO0lBQy9CLEtBQUssQ0FBQyxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDM0QsQ0FBQyxDQUFBO0FBR0QsSUFBSSxhQUFhLEdBQUcsQ0FBQyxHQUFHLE1BQU0sQ0FBQyxDQUFDO0FBS2hDLElBQUksV0FBVyxHQUFHLEVBQUUsQ0FBQztBQUNyQixLQUFLLElBQUksS0FBSyxHQUFHLENBQUMsRUFBRSxLQUFLLEdBQUcsYUFBYSxDQUFDLE1BQU0sRUFBRSxLQUFLLEVBQUUsRUFBRTtJQUN2RCxJQUFJLFlBQVksR0FBRyxhQUFhLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDeEMsSUFBSSxHQUFHLEdBQUcsWUFBWSxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQzFCLElBQUksS0FBSyxHQUFHLFlBQVksQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUM1QixXQUFXLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxLQUFLLEVBQUUsR0FBRyxDQUFDLENBQUM7Q0FDckMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgRXJybm9FeGNlcHRpb24gPSBOb2RlSlMuRXJybm9FeGNlcHRpb247XG5pbXBvcnQgKiBhcyBsaWJwYXRoIGZyb20gXCJwYXRoXCI7XG5pbXBvcnQgKiBhcyBmcyBmcm9tIFwiZnNcIjtcbmltcG9ydCB7RmlsZVBhdGhzfSBmcm9tIFwicG9sYXItc2hhcmVkL3NyYy91dGlsL0ZpbGVQYXRoc1wiO1xuaW1wb3J0IHtQYXRoU3RyfSBmcm9tIFwicG9sYXItc2hhcmVkL3NyYy91dGlsL1N0cmluZ3NcIjtcbmltcG9ydCAqIGFzIHBhdGggZnJvbSAncGF0aCc7XG5cbmV4cG9ydCBjbGFzcyBTZWFyY2gge1xuICAgIHB1YmxpYyBzdGF0aWMgZmluZChkaXI6IHN0cmluZywgb3B0czogT3B0cyA9IG5ldyBEZWZhdWx0T3B0cygpKTogUmVhZG9ubHlBcnJheTxJRmlsZT4ge1xuICAgICAgICBjb25zdCBmaWxlcyA9IGZzLnJlYWRkaXJTeW5jKGRpcik7XG5cbiAgICAgICAgY29uc3QgcmVzdWx0OiBJRmlsZVtdID0gW107XG5cbiAgICAgICAgZm9yIChjb25zdCBuYW1lIG9mIGZpbGVzKSB7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnN0IHBhdGggPSBsaWJwYXRoLmpvaW4oZGlyLCBuYW1lKTtcbiAgICAgICAgICAgIGNvbnN0IHN0YXQgPSBmcy5zdGF0U3luYyhwYXRoKTtcblxuICAgICAgICAgICAgY29uc3QgY3JlYXRlVHlwZSA9ICgpOiBGaWxlVHlwZSB8IHVuZGVmaW5lZCA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHN0YXQuaXNEaXJlY3RvcnkoKSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ2RpcmVjdG9yeSc7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKHN0YXQuaXNGaWxlKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdmaWxlJztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBjb25zdCB0eXBlID0gY3JlYXRlVHlwZSgpO1xuICAgICAgICAgICAgaWYgKCEgdHlwZSkge1xuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgY3JlYXRlUmVjb3JkID0gKCk6IElGaWxlID0+IHtcbiAgICAgICAgICAgICAgICByZXR1cm4ge3R5cGUsIG5hbWUsIHBhdGh9O1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgY29uc3QgZmlsZSA9IGNyZWF0ZVJlY29yZCgpO1xuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIFJldHVybiB0cnVlIGlmIHdlIHNob3VsZCBhY2NlcHQgdGhlIGZpbGUuXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIGNvbnN0IGFjY2VwdEZpbGUgPSAoKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgYWNjZXB0RXh0ZW5zaW9uID0gKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAoISBvcHRzLmV4dGVuc2lvbnMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGV4dCA9IEZpbGVQYXRocy50b0V4dGVuc2lvbihwYXRoKS5nZXRPclVuZGVmaW5lZCgpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZXh0ICYmIG9wdHMuZXh0ZW5zaW9ucy5pbmNsdWRlcyhleHQpO1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgY29uc3QgYWNjZXB0VHlwZSA9ICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCEgb3B0cy50eXBlcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9wdHMudHlwZXMuaW5jbHVkZXModHlwZSk7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICByZXR1cm4gYWNjZXB0RXh0ZW5zaW9uKCkgJiYgYWNjZXB0VHlwZSgpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGlmIChhY2NlcHRGaWxlKCkpIHtcbiAgICAgICAgICAgICAgICByZXN1bHQucHVzaChmaWxlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChvcHRzLnJlY3Vyc2UgJiYgdHlwZSA9PT0gJ2RpcmVjdG9yeScpIHtcbiAgICAgICAgICAgICAgICByZXN1bHQucHVzaCguLi50aGlzLmZpbmQocGF0aCwgb3B0cykpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxufVxuXG4vLy8gdGhlIGZpbGUgdHlwZSB0aGF0IGlzIGNvbXBhdGliYWxlXG5leHBvcnQgdHlwZSBGaWxlVHlwZSA9ICdmaWxlJyB8ICdkaXJlY3RvcnknO1xuLy8vIEEgZmlsZSBleHRlbnNpb24gd2l0aG91dCB0aGUgJy4nIHByZWZpeC4gIEV4YW1wbGU6IGpwZywganBlZywgdHh0XG5leHBvcnQgdHlwZSBGaWxlRXh0ID0gc3RyaW5nO1xuXG5jbGFzcyBEZWZhdWx0T3B0cyBpbXBsZW1lbnRzIE9wdHMge1xuICAgIHB1YmxpYyByZWFkb25seSByZWN1cnNlID0gdHJ1ZTtcbiAgICBwdWJsaWMgcmVhZG9ubHkgdHlwZXM6IFJlYWRvbmx5QXJyYXk8RmlsZVR5cGU+ID0gWydmaWxlJ107XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgT3B0cyB7XG4gICAgcmVhZG9ubHkgcmVjdXJzZT86IGJvb2xlYW47XG4gICAgLy8vIE9ubHkgYWNjZXB0IHRoZSBnaXZlbiBmaWxlIHR5cGVzLiAgQnkgZGVmYXVsdCBhbGwgdHlwZXMgYXJlIGFjY2VwdGVkLlxuICAgIHJlYWRvbmx5IHR5cGVzPzogUmVhZG9ubHlBcnJheTxGaWxlVHlwZT47IFxuICAgIC8vLyBPbmx5IGFjY2VwdCB0aGUgZ2l2ZW4gZXh0ZW5zaW9ucy4gQnkgZGVmYXVsdCBhbGwgZXh0ZW5zaW9uIGFyZSBhY2NlcHRlZC5cbiAgICByZWFkb25seSBleHRlbnNpb25zPzogUmVhZG9ubHlBcnJheTxGaWxlRXh0PjsgXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgSUZpbGUge1xuICAgIHJlYWRvbmx5IG5hbWU6IHN0cmluZzsgXG4gICAgcmVhZG9ubHkgcGF0aDogUGF0aFN0cjsgLy8vIHRoZSBlbnRpcmUgcGF0aCBvZiB0aGUgZmlsZVxuICAgIHJlYWRvbmx5IHR5cGU6IEZpbGVUeXBlOyAvLy8gd2hhdCB0eXBlIHRoZSBmaWxlIGlzXG59XG5cbi8vLyBjcmVhdGVzIGFuIGVtcHR5IG1hcFxubGV0IGhpdE1hcCA9IG5ldyBNYXAoKTtcbmxldCBvcHRzID0gbmV3IERlZmF1bHRPcHRzKCk7XG5cbi8qKlxuICogdXNlcyBwcm9jZXNzLmFyZ3YgdG8gc2VlIHdoaWNoIGRpcmVjdG9yeSB0byBwYXJzZSB0aHJvdWdoIHVzaW5nIHRoZSBjb21tYW5kIGxpbmVcbiAqIGV4YW1wbGU6IG5vZGUgU2VhcmNoLmpzIC9Vc2Vycy9taWhpcm1hY3BybzEzL0RvY3VtZW50cy9HaXRIdWIvc3RhbGUtZmluZGVyLXRlc3QtZGlyZWN0b3J5L1xuICovIFxudmFyIG15QXJncyA9IHByb2Nlc3MuYXJndlsyXTtcbi8vLyBTZWFyY2guZmluZCByZXR1cm5zIGFuIGFycmF5IHdpdGggYWxsIHRoZSBmaWxlcyBpbiB0aGUgZGlyZWN0b3J5XG4vLy8gaXRlcmF0ZXMgdGhyb3VnaCBlYWNoIGZpbGUgaW4gdGhlIGRpcmVjdG9yeVxudmFyIGZpbGVNYXAgPSBTZWFyY2guZmluZChteUFyZ3MsIG9wdHMpO1xuZm9yICh2YXIgaSA9IDA7IGkgPCBmaWxlTWFwLmxlbmd0aDsgaSsrKSB7XG4gICAgLy8vIG1hcCBvZiB0aGUgZmlsZSB0eXBlLCBuYW1lLCBwYXRoIFxuICAgIHZhciBmaWxlID0gZmlsZU1hcFtpXTtcbiAgICB2YXIgaW5pdGlhbEZpbGVOYW1lID0gZmlsZS5uYW1lO1xuICAgIHZhciBpbml0aWFsRmlsZVBhdGggPSBmaWxlLnBhdGg7XG4gICAgXG4gICAgLy8vIGNoZWNrcyB0byBzZWUgaWYgdGhlIGZpbGUgbmFtZSBpcyB0ZXN0LnRzXG4gICAgLy8vIGlmIGl0IGlzIHRoZW4gY29udGludWVzIHRvIHRoZSBuZXh0IGZpbGVcbiAgICBpZiAoZmlsZS5uYW1lID09PSAndGVzdC50cycgIHx8IGZpbGUubmFtZS5pbmNsdWRlcygnLmQudHMnKSkge1xuICAgICAgICBjb250aW51ZTtcbiAgICB9XG4gICAgLy8vIGNoZWNrcyB0byBtYWtlIHN1cmUgdGhhdCB0aGUgZmlsZSB0eXBlIGlzIGVpdGhlciAudHMgb3IgLnRzeFxuICAgIGVsc2UgaWYgKGluaXRpYWxGaWxlTmFtZS5zcGxpdCgnLicpLnBvcCgpID09PSAndHMnIHx8IGluaXRpYWxGaWxlTmFtZS5zcGxpdCgnLicpLnBvcCgpID09PSAndHN4Jykge1xuICAgICAgICAvLy8gZ2V0cyBhbGwgdGhlIGNvbnRlbnRzIG9mIHRoZSBjdXJyZW50IGZpbGVcbiAgICAgICAgY29uc3QgZGF0YSA9IGZzLnJlYWRGaWxlU3luYyhpbml0aWFsRmlsZVBhdGgsJ3V0ZjgnKTtcbiAgICAgICAgLy8vIHNwbGl0cyBlYWNoIGxpbmUgb2YgZGF0YSB0byBhbGxvdyB1cyB0byBwYXJzZSB0aHJvdWdoIGVhY2ggb25lXG4gICAgICAgIGNvbnN0IGxpbmVzID0gZGF0YS5zcGxpdCgvXFxyP1xcbi8pO1xuICAgICAgICAvLy8gY3JlYXRlcyBhIHJlZ3VsYXIgZXhwcmVzc2lvbiBmb3IgdGhlIGltcG9ydCBsaW5lc1xuICAgICAgICBsZXQgcmUgPSAvaW1wb3J0KD86W1wiJ1xcc10qKFtcXHcqe31cXG5cXHJcXHQsIF0rKWZyb21cXHMqKT9bXCInXFxzXS4qKFtAXFx3Xy1dKylbXCInXFxzXS4qOyQvO1xuICAgICAgICAvLy8gaXRlcmF0ZXMgdGhyb3VnaCBlYWNoIGxpbmUgb2YgdGhlIGZpbGVcbiAgICAgICAgbGluZXMuZm9yRWFjaCgobGluZSkgPT4ge1xuICAgICAgICAgICAgLy8vIGNoZWNrcyB0byBzZWUgaWYgdGhlIGxpbmUgbWF0Y2hlcyB0aGUgZm9ybWF0IG9mIHRoZSByZWd1bGFyIGV4cHJlc3Npb25cbiAgICAgICAgICAgIGxldCBpbXBvcnRMaW5lID0gbGluZS5tYXRjaChyZSk7XG4gICAgICAgICAgICAvLy8gbWFrZXMgc3VyZSB0aGF0IHRoZSBsaW5lIGFjdHVhbGx5IGhhcyB0aGUgcHJvcGVyIGZvcm1hdCBvZiB0aGUgcmVnRXhcbiAgICAgICAgICAgIGlmIChpbXBvcnRMaW5lICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICAvLy8gZ2V0cyB0aGUgZW50aXJlIGltcG9ydCBsaW5lcyBjb250ZW50c1xuICAgICAgICAgICAgICAgIGxldCBpbXBvcnRWYWwgPSBpbXBvcnRMaW5lWzBdO1xuICAgICAgICAgICAgICAgIC8vLyBzcGxpdHMgdGhlIGxpbmUgYmFzZWQgb2ZmIHNwYWNlcyBhbmQgZ2V0cyBvbmx5IHRoZSBmaWxlIHBhdGhcbiAgICAgICAgICAgICAgICBsZXQgZmlsZVBhdGggPSBpbXBvcnRWYWwuc3BsaXQoJyAnKS5wb3AoKTtcbiAgICAgICAgICAgICAgICB2YXIgZnVsbFBhdGg7XG4gICAgICAgICAgICAgICAgLy8vIGNvbnZlcnRzIHRoYXQgZmlsZSBwYXRoIGludG8gYSBmdWxsIGZpbGUgcGF0aFxuICAgICAgICAgICAgICAgIGlmIChmaWxlUGF0aCAhPSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZpbGVQYXRoLmluY2x1ZGVzKCcuLycpIHx8IGZpbGVQYXRoLmluY2x1ZGVzKCcuLi8nKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8vIGZpeGVzIHRoZSBwdW5jdHVhdGlvbiBvZiB0aGUgZmlsZSBwYXRoIG9mIHRoZSBpbXBvcnRcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVQYXRoID0gZmlsZVBhdGgucmVwbGFjZSgvWydcIl0rL2csICcnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmaWxlUGF0aC5pbmNsdWRlcygnLnRzJykgPT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlUGF0aCA9IGZpbGVQYXRoLnJlcGxhY2UoZmlsZVBhdGguc3Vic3RyaW5nKGZpbGVQYXRoLmxlbmd0aC0xKSwgXCJcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZVBhdGggPSBmaWxlUGF0aCArICcudHM7JztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmdWxsRGlyZWN0b3J5ID0gcGF0aC5iYXNlbmFtZShpbml0aWFsRmlsZVBhdGgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZnVsbFBhdGggPSBwYXRoLnJlc29sdmUoZnVsbERpcmVjdG9yeSwgZmlsZVBhdGgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coZnVsbFBhdGgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZzLmV4aXN0c1N5bmMoZnVsbFBhdGgpID09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJGaWxlIGRvZXMgbm90IGV4aXN0IVwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vLyBjaGVja3MgdG8gc2VlIGlmIHRoZSBoaXRtYXAgYWxyZWFkeSBoYXMgdGhhdCBwYXRoXG4gICAgICAgICAgICAgICAgaWYgKGhpdE1hcC5oYXMoZnVsbFBhdGgpID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vLyBpZiBpdCBkb2VzIHRoZW4gaW5jcmVtZW50cyB0aGUgdmFsdWUgb2YgdGhhdCBmaWxlIGJ5IDFcbiAgICAgICAgICAgICAgICAgICAgdmFyIGN1cnJWYWwgPSBoaXRNYXAuZ2V0KGZ1bGxQYXRoKTtcbiAgICAgICAgICAgICAgICAgICAgaGl0TWFwLnNldChmdWxsUGF0aCwgY3VyclZhbCArIDEpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvLy8gaWYgdGhlIGhpdG1hcCBkb2VzIG5vdCBoYXZlIHRoYXQgcGF0aCBhcyBhIGtleSBhbHJlYWR5XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIC8vLyB0aGVuIHNldHMgdGhhdCBmaWxlIHBhdGggdG8gaGF2ZSBhIHZhbHVlIG9mIDFcbiAgICAgICAgICAgICAgICAgICAgaGl0TWFwLnNldChmdWxsUGF0aCwgMSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG59XG5cbi8qKlxuICogU29ydHMgdGhlIG1hcCBpbiBvcmRlciBiYXNlZCBvbiB0aGUgdmFsdWVzIFxuICovXG5oaXRNYXBbU3ltYm9sLml0ZXJhdG9yXSA9IGZ1bmN0aW9uKiAoKSB7XG4gICAgeWllbGQqIFsuLi50aGlzLmVudHJpZXMoKV0uc29ydCgoYSwgYikgPT4gYVsxXSAtIGJbMV0pO1xufVxuXG4vLy8gbWFrZXMgdGhlIG1hcCBpbnRvIGEgdGFibGUgdHlwZSBmb3JtYXQgd2l0aCBhIG5lc3RlZCBhcnJheVxudmFyIHVwZGF0ZWRIaXRNYXAgPSBbLi4uaGl0TWFwXTtcblxuLyoqXG4gKiBzd2FwcyB0aGUga2V5IGFuZCB0aGUgdmFsdWUgb2YgdGhlIG1hcCwgc28gdGhlIGtleSBpcyB0aGUgbnVtYmVyIG9mIGhpdHMgYW5kIHRoZSB2YWx1ZSBpcyB0aGUgZnVsbCBmaWxlIHBhdGhcbiAqL1xudmFyIGZpbmFsSGl0TWFwID0gW107XG5mb3IgKHZhciBpbmRleCA9IDA7IGluZGV4IDwgdXBkYXRlZEhpdE1hcC5sZW5ndGg7IGluZGV4KyspIHtcbiAgICB2YXIgY3VycmVudEFycmF5ID0gdXBkYXRlZEhpdE1hcFtpbmRleF07XG4gICAgdmFyIGtleSA9IGN1cnJlbnRBcnJheVswXTtcbiAgICB2YXIgdmFsdWUgPSBjdXJyZW50QXJyYXlbMV07XG4gICAgZmluYWxIaXRNYXBbaW5kZXhdID0gW3ZhbHVlLCBrZXldO1xufVxuLy8vIHByaW50cyBvdXQgdGhlIGhpdE1hcFxuLy9jb25zb2xlLmxvZyhmaW5hbEhpdE1hcCk7IFxuIl19